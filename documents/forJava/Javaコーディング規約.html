<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <meta name="author" content="Future Enterprise Coding Standards">
  <meta name="keywords" content="Java,コーディング規約,Javaコーディング規約">
  <title>Javaコーディング規約 – Future Enterprise Coding Standards - フューチャーアーキテクト</title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
  <link href="data:text/css;charset=utf-8,body%20%7B%0Afont%2Dfamily%3A%20Helvetica%2C%20arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E6%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%2010px%3B%0Abackground%2Dcolor%3A%20white%3B%0Apadding%3A%2030px%3B%20%7D%0Abody%20%3E%20%2A%3Afirst%2Dchild%20%7B%0Amargin%2Dtop%3A%200%20%21important%3B%20%7D%0Abody%20%3E%20%2A%3Alast%2Dchild%20%7B%0Amargin%2Dbottom%3A%200%20%21important%3B%20%7D%0Abody%20%7B%0Amargin%2Dleft%3A%20300px%3B%0A%7D%0A%23TOC%20%7B%0Aposition%3A%20fixed%3B%0Aleft%3A%200%3B%0Atop%3A%200%3B%0Abottom%3A%200%3B%0Aoverflow%2Dy%3A%20auto%3B%0Awidth%3A%20300px%3B%0Atransition%3A%20width%2Cfont%2Dsize%2Copacity%20300ms%2C300ms%2C300ms%20ease%2Din%2Dout%2Cease%2Din%2Dout%2Cease%2Din%2Dout%3B%0Apadding%2Dleft%3A%201em%3B%0Abox%2Dsizing%3A%20border%2Dbox%3B%0A%7D%0A%23TOC%20ul%20%7B%0Amargin%3A%200%200%200%201em%3B%0Apadding%3A%200%3B%0A%7D%0A%40media%20all%20and%20%28max%2Dwidth%3A%201000px%29%20%7B%0Abody%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0A%23TOC%20%7B%0Aoverflow%3A%20hidden%3B%0Awidth%3A%200%3B%0Aopacity%3A%200%3B%0A%7D%0A%7D%0A%40media%20print%20%7B%0Abody%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0A%23TOC%20%7B%0Adisplay%3A%20none%3B%0A%7D%0A%7D%0Ah1%2Etitle%20%7B%0Afont%2Dsize%3A%2042px%3B%0Aborder%2Dbottom%3A%202px%20solid%20%23cccccc%3B%0A%7D%0A%40media%20print%20%7B%0Ah1%2Etitle%20%7B%0Atext%2Dalign%3A%20center%3B%0Amargin%2Dtop%3A%2050%25%3B%0Apage%2Dbreak%2Dbefore%3A%20auto%3B%0A%7D%0A%7D%0Ah2%2Eauthor%20%7B%0Afont%2Dsize%3A%2012px%3B%0Aborder%3A%20none%3B%0Acolor%3A%20initial%3B%0Atext%2Dalign%3A%20right%3B%0Amargin%3A%200%3B%0Apage%2Dbreak%2Dafter%3A%20always%3B%0A%7D%0Ah1%20%7B%0Apage%2Dbreak%2Dbefore%3A%20always%3B%0A%7D%0Ah1%2C%20h2%2C%20h3%2C%20h4%2C%20h5%2C%20h6%20%7B%0Amargin%3A%2020px%200%2010px%3B%0Apadding%3A%200%3B%0Afont%2Dweight%3A%20bold%3B%0A%2Dwebkit%2Dfont%2Dsmoothing%3A%20antialiased%3B%0Acursor%3A%20text%3B%0Aposition%3A%20relative%3B%0Apage%2Dbreak%2Dafter%3A%20avoid%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%234183C4%3B%0A%7D%0Ah1%20%7B%0Afont%2Dsize%3A%2028px%3B%0Acolor%3A%20black%3B%0A%7D%0Ah2%20%7B%0Afont%2Dsize%3A%2024px%3B%0Aborder%2Dbottom%3A%201px%20solid%20%23cccccc%3B%0Acolor%3A%20black%3B%0A%7D%0Ah3%20%7B%0Afont%2Dsize%3A%2018px%3B%0A%7D%0Ah4%20%7B%0Afont%2Dsize%3A%2016px%3B%0A%7D%0Ah5%20%7B%0Afont%2Dsize%3A%2014px%3B%0A%7D%0Ah6%20%7B%0Acolor%3A%20%23777777%3B%0Afont%2Dsize%3A%2014px%3B%0A%7D%0Ap%2C%20blockquote%2C%20ul%2C%20ol%2C%20dl%2C%20li%2C%20table%2C%20pre%20%7B%0Amargin%3A%2015px%200%3B%0A%7D%0Ahr%20%7B%0Aborder%3A%20none%3B%0Aborder%2Dbottom%3A%201px%20dashed%20%23cccccc%3B%0A%7D%0Atable%20%7B%0Apadding%3A%200%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20tr%20th%20%7B%0Afont%2Dweight%3A%20bold%3B%0Aborder%3A%201px%20solid%20%23cccccc%3B%0Atext%2Dalign%3A%20left%3B%0Apadding%3A%206px%2013px%3B%0A%7D%0Atable%20tr%20td%20%7B%0Aborder%3A%201px%20solid%20%23cccccc%3B%0Apadding%3A%206px%2013px%3B%0A%7D%0Atable%20tr%3Anth%2Dchild%282n%29%20%7B%0Abackground%2Dcolor%3A%20%23f8f8f8%3B%0A%7D%0Atable%20%2A%20%7B%0Aword%2Dwrap%3A%20break%2Dword%3B%0Aword%2Dbreak%3A%20break%2Dall%3B%0A%7D%0Apre%20%7B%0Abackground%2Dcolor%3A%20%23f8f8f8%3B%0Aborder%3A%201px%20solid%20%23cccccc%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%2019px%3B%0Aoverflow%3A%20auto%3B%0Apadding%3A%206px%2010px%3B%0Aborder%2Dradius%3A%203px%3B%0A%7D%0Apre%20code%20%7B%0Amargin%3A%200%3B%0Apadding%3A%200%3B%0Awhite%2Dspace%3A%20pre%3B%0Aborder%3A%20none%3B%0Abackground%3A%20transparent%3B%0A%7D%0Acode%2C%20tt%20%7B%0Amargin%3A%200%202px%3B%0Apadding%3A%200%205px%3B%0Awhite%2Dspace%3A%20nowrap%3B%0Aborder%3A%201px%20solid%20%23eaeaea%3B%0Abackground%2Dcolor%3A%20%23f8f8f8%3B%0Aborder%2Dradius%3A%203px%3B%0A%7D%0Adiv%2EsourceCode%20%7B%0Apage%2Dbreak%2Dbefore%3A%20avoid%3B%0Apage%2Dbreak%2Dinside%3A%20avoid%3B%0A%7D%0Ali%20%2A%20%7B%0Amargin%3A%200%3B%0A%7D%0Ablockquote%20%7B%0Aborder%2Dleft%3A%204px%20solid%20%23dddddd%3B%0Apadding%3A%200%2015px%3B%0Acolor%3A%20%23777777%3B%0A%7D%0Ablockquote%20%3E%20%3Afirst%2Dchild%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Ablockquote%20%3E%20%3Alast%2Dchild%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Acode%2Ecomment%2Dcode%20%7B%0Adisplay%3A%20block%3B%0Awhite%2Dspace%3A%20pre%3B%0A%7D%0Atable%20%7B%0Aoverflow%3A%20auto%3B%0Adisplay%3A%20block%3B%0A%7D%0A%40media%20screen%20and%20%28max%2Dwidth%3A%201300px%29%20and%20%28min%2Dwidth%3A%201001px%29%20%7B%0A%23TOC%20%7B%0Afont%2Dsize%3A%2080%25%3B%0Awidth%3A%20200px%3B%0A%7D%0Abody%20%7B%0Amargin%2Dleft%3A%20200px%3B%0A%7D%0A%7D%0A%40media%20screen%20and%20%28max%2Dwidth%3A%201100px%29%20and%20%28min%2Dwidth%3A%201001px%29%20%7B%0A%23TOC%20%7B%0Afont%2Dsize%3A%2060%25%3B%0Awidth%3A%20150px%3B%0A%7D%0Abody%20%7B%0Amargin%2Dleft%3A%20150px%3B%0A%7D%0Atable%20tr%20td%20%7B%0Afont%2Dsize%3A%2080%25%3B%0Apadding%3A%203px%206px%3B%0A%7D%0A%7D%0A%40media%20all%20and%20%28max%2Dwidth%3A%201000px%29%20%7B%0Atable%20tr%20td%20%7B%0Afont%2Dsize%3A%2080%25%3B%0Apadding%3A%203px%206px%3B%0A%7D%0A%7D%0A%40media%20all%20and%20%28max%2Dwidth%3A%20800px%29%20%7B%0Atable%20tr%20td%20%7B%0Afont%2Dsize%3A%2070%25%3B%0A%7D%0A%7D%0A%40media%20all%20and%20%28max%2Dwidth%3A%20600px%29%20%7B%0Atable%20tr%20td%20%7B%0Afont%2Dsize%3A%2060%25%3B%0A%7D%0A%7D%0A" rel="stylesheet">
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
</head>
<body>
<header>
<h1 class="title">Javaコーディング規約</h1>
<h2 class="author">Future Enterprise Coding Standards</h2>
</header>
<div style="text-align: right;padding-top: 30px;">
    <span>
    <div class="fb-like" data-href="https://future-architect.github.io/coding-standards/documents/forJava/Java%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A6%8F%E7%B4%84.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
    </span>

    <a href="http://b.hatena.ne.jp/entry/https://future-architect.github.io/coding-standards/documents/forJava/Java%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E8%A6%8F%E7%B4%84.html" class="hatena-bookmark-button" data-hatena-bookmark-title="Javaコーディング規約 - フューチャーアーキテクト" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAoCAYAAACM/rhtAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAldJREFUeNpiZAAC04nHA4BUPxArMAwO8ACIC0/nW25ghDpuPcPgBIEs0JBj+MbCwvCMk4fhPRv7gLpI8NdPBqnvXxi4/vwBcfuZYNE6GBwHAiA3gNwCBQpMyBKDBXxiZYOzmQZjwvvLyDi4HYgMRh046sBRBxIALKQo3u8iiVPu4KsfDA++/GbY8OQbw4df//Dqc9zznDYOdBDnICjXD3Rc4KGXDAde/iBKH92jWICNiWG9nTiYHrRpEOQ4A0E2+qdBdMA44T6YNhBlYzgfLT14c/GF17/AGKXF+enPwIeggw4HgwArE4O/FDc4FGGg8cQHiANZB9iB2IqdA09+MCy49plCk5EceOctlPWPOgY6yHCA06PjmucY0Q4Hrwmbc+c9FdLggfs/4BglF7MzMdRbCA58GnSch6gREgx5GOYHicL5AcpciDS5/8MA5WJWBH7wAXeunXDsI8OH73/BGMSmXy7WglRhCnwsDPmG/KjFDJKD9ydJMhhIQnJ5vCEvg+HKp3TKxSG4Gw8Lz3+BF+Iwx4H5kmx0jGIcYAHQcQ0H3sML8Q8/EEUEMpvqIYieW1Fqkxe/GB6+Bza3rn+DRC8sj/yBZKZ6R0FohnlPWnUqWHf8P7hfLChOWPVbIk0FdbF5kPjvgPg/zEYgFiJihOH9SzLSIL6qixmK2bAkHD4g/g5lc9KyHOSjoLTlHe00jTpw1IG0dSDr75+DxlHIbgE58AG4ePr+ZcAdyfj/P9gNILfA2hygEqoQiNcz//3DwPPlw2CL4ULwUCawuhuU0xDvmyw3AAQYALCcxAMK3iZ8AAAAAElFTkSuQmCC" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a><script src="data:application/x-javascript;base64,dmFyIEhhdGVuYSA9IEhhdGVuYSB8fCB7fTsKCi8qIFVURi04IOOBp+OBquOBhOODmuODvOOCuOOBi+OCieiqreOBv+i+vOOBvuOCjOOBpuOCguWLleOBj+OCiOOBhuOBq+OAgQogKiDjgrPjg6Hjg7Pjg4jjga/opIfmlbDooYzjgrPjg6Hjg7Pjg4ggKOmWieOBmOOCiyAiKiIg44Gu5YmN44Gr44K544Oa44O844K544KS572u44GPKSDjgpLkvb/jgYTjgIEKICog5paH5a2X5YiX44Oq44OG44Op44Or5Lit44GuIEFTQ0lJIOWkluOBruaWh+Wtl+OBryBcdVhYWFgg44Go44Ko44K544Kx44O844OX44GZ44KL44CCCiAqLwoKKGZ1bmN0aW9uIChIYXRlbmEpIHsKCnZhciBCID0gSGF0ZW5hLkJvb2ttYXJrID0gSGF0ZW5hLkJvb2ttYXJrIHx8IHt9OwppZiAoQi5Cb29rbWFya0J1dHRvbikgcmV0dXJuOwoKaWYgKGxvY2F0aW9uLnByb3RvY29sID09PSAnaHR0cHM6JykgewogICAgQi5hcGlPcmlnaW4gPSAnaHR0cHM6Ly9iLmhhdGVuYS5uZS5qcCc7Cn0gZWxzZSB7CiAgICBCLmFwaU9yaWdpbiA9ICdodHRwOi8vY2RuLmFwaS5iLmhhdGVuYS5uZS5qcCc7Cn0KQi5vcmlnaW4gPSBsb2NhdGlvbi5wcm90b2NvbCArICcvL2IuaGF0ZW5hLm5lLmpwJzsKQi5zdGF0aWNPcmlnaW4gPSBsb2NhdGlvbi5wcm90b2NvbCArICcvL2Iuc3QtaGF0ZW5hLmNvbSc7Cgp2YXIgbWF0Y2ggPSBuZXcgUmVnRXhwKCdeKCg/OmxvY2FsfGIoPyFsb2cpXFx3KylcXC5oYXRlbmFcXC5uZVxcLmpwKD86OjMwMDApPykkJykuZXhlYyhsb2NhdGlvbi5ob3N0KTsKdmFyIGlzTG9jYWw7CmlmIChtYXRjaCkgewogICAgQi5vcmlnaW4gPSBCLmFwaU9yaWdpbiA9IEIuc3RhdGljT3JpZ2luID0gJ2h0dHA6Ly8nICsgbWF0Y2hbMV07CiAgICBpc0xvY2FsID0gdHJ1ZTsKfQoKdmFyIFUgPSBCLkJ1dHRvblV0aWxzID0ge307Cgp2YXIgZXh0ZW5kID0gVS5leHRlbmQgPSBmdW5jdGlvbiAoZGVzdCwgc3JjKSB7CiAgICBmb3IgKHZhciBpIGluIHNyYykKICAgICAgICBkZXN0W2ldID0gc3JjW2ldOwogICAgcmV0dXJuIGRlc3Q7Cn07Cgp2YXIgRSA9IFUuY3JlYXRlRWxlbWVudCA9IGZ1bmN0aW9uIChuYW1lLCBwcm9wcykgewogICAgdmFyIGVsZW1lbnQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KG5hbWUpOwogICAgZm9yICh2YXIgcCBpbiBwcm9wcykKICAgICAgICBlbGVtZW50W3BdID0gcHJvcHNbcF07CiAgICBmb3IgKHZhciBpID0gMjsgaSA8IGFyZ3VtZW50cy5sZW5ndGg7IGkrKykgewogICAgICAgIHZhciBjaGlsZCA9IGFyZ3VtZW50c1tpXTsKICAgICAgICBpZiAoIWNoaWxkLm5vZGVUeXBlKQogICAgICAgICAgICBjaGlsZCA9IGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKGNoaWxkKTsKICAgICAgICBlbGVtZW50LmFwcGVuZENoaWxkKGNoaWxkKTsKICAgIH0KICAgIHJldHVybiBlbGVtZW50Owp9OwoKdmFyIGdldExvY2F0aW9uID0gVS5nZXRMb2NhdGlvbiA9IGZ1bmN0aW9uICgpIHsKICAgIHZhciB1cmwgPSBsb2NhdGlvbi5ocmVmOwogICAgLyogU2FmYXJpIOOBryBsb2NhdGlvbi5ocmVmIOOBp+ODkeOCueS4reOBriBVUkkg44Ko44K544Kx44O844OX44KSCiAgICAgKiDjg4fjgrPjg7zjg4njgZfjgabjgZfjgb7jgYbjga7jgafjgIFkb2N1bWVudC5VUkwg44KC6Kq/44G544Gm44G/44KLCiAgICAgKi8KICAgIGlmICh1cmwubGVuZ3RoIDwgZG9jdW1lbnQuVVJMLmxlbmd0aCkKICAgICAgICB1cmwgPSBkb2N1bWVudC5VUkw7CiAgICByZXR1cm4gdXJsOwp9OwoKdmFyIFZpZXcgPSBVLlZpZXcgPSB7CiAgICByb290OiBudWxsLAogICAgY2xpZW50TGVmdDogMCwKICAgIGNsaWVudFRvcDogMCwKICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLnJvb3QgPSAoKGRvY3VtZW50LmNvbXBhdE1vZGUgfHwgJycpID09PSAnQ1NTMUNvbXBhdCcpCiAgICAgICAgICAgICAgICAgICAgPyBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQgOiBkb2N1bWVudC5ib2R5OwogICAgICAgIHRoaXMuY2xpZW50TGVmdCA9IHRoaXMucm9vdC5jbGllbnRMZWZ0IHx8IDA7CiAgICAgICAgdGhpcy5jbGllbnRUb3AgPSB0aGlzLnJvb3QuY2xpZW50VG9wIHx8IDA7CiAgICB9LAogICAgZ2V0RWxlbWVudFJlY3Q6IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgaWYgKCF0aGlzLnJvb3QpIHRoaXMuaW5pdCgpOwogICAgICAgIHRoaXMuZ2V0RWxlbWVudFJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdAogICAgICAgICAgICA/IHRoaXMuZ2V0RWxlbWVudFJlY3RCeVJlY3QgOiB0aGlzLmdldEVsZW1lbnRSZWN0QnlPZmZzZXQ7CiAgICAgICAgcmV0dXJuIHRoaXMuZ2V0RWxlbWVudFJlY3QoZWxlbWVudCk7CiAgICB9LAogICAgZ2V0RWxlbWVudFJlY3RCeVJlY3Q6IGZ1bmN0aW9uIChlbGVtZW50KSB7CiAgICAgICAgdmFyIHJlY3QgPSBlbGVtZW50LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpOwogICAgICAgIHZhciBzY3JvbGwgPSB0aGlzLmdldFNjcm9sbCgpOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAgIHg6IHJlY3QubGVmdCArIHNjcm9sbC54IC0gdGhpcy5jbGllbnRMZWZ0LAogICAgICAgICAgICB5OiByZWN0LnRvcCArIHNjcm9sbC55IC0gdGhpcy5jbGllbnRUb3AsCiAgICAgICAgICAgIHdpZHRoOiByZWN0LndpZHRoIHx8IHJlY3QucmlnaHQgLSByZWN0LmxlZnQsCiAgICAgICAgICAgIGhlaWdodDogcmVjdC5oZWlnaHQgfHwgcmVjdC5ib3R0b20gLSByZWN0LnRvcAogICAgICAgIH07CiAgICB9LAogICAgZ2V0RWxlbWVudFJlY3RCeU9mZnNldDogZnVuY3Rpb24gKGVsZW1lbnQpIHsKICAgICAgICB2YXIgeCA9IDAsIHkgPSAwOwogICAgICAgIGZvciAodmFyIG5vZGUgPSBlbGVtZW50LCBiYXNlOyBiYXNlID0gbm9kZS5vZmZzZXRQYXJlbnQ7IG5vZGUgPSBiYXNlKSB7CiAgICAgICAgICAgIHggKz0gbm9kZS5vZmZzZXRMZWZ0OwogICAgICAgICAgICB5ICs9IG5vZGUub2Zmc2V0VG9wOwogICAgICAgIH0KICAgICAgICByZXR1cm4geyB4OiB4LCB5OiB5LCB3aWR0aDogZWxlbWVudC5vZmZzZXRXaWR0aCwgaGVpZ2h0OiBlbGVtZW50Lm9mZnNldEhlaWdodCB9OwogICAgfSwKICAgIGdldFdpbmRvd1NpemU6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAoIXRoaXMucm9vdCkgdGhpcy5pbml0KCk7CiAgICAgICAgcmV0dXJuIHsgd2lkdGg6IHRoaXMucm9vdC5jbGllbnRXaWR0aCwgaGVpZ2h0OiB0aGlzLnJvb3QuY2xpZW50SGVpZ2h0IH07CiAgICB9LAogICAgZ2V0RG9jdW1lbnRTaXplOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCF0aGlzLnJvb3QpIHRoaXMuaW5pdCgpOwogICAgICAgIHJldHVybiB7IHdpZHRoOiB0aGlzLnJvb3Quc2Nyb2xsV2lkdGgsIGhlaWdodDogdGhpcy5yb290LnNjcm9sbEhlaWdodCB9OwogICAgfSwKICAgIGdldFNjcm9sbDogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghdGhpcy5yb290KSB0aGlzLmluaXQoKTsKICAgICAgICB0aGlzLmdldFNjcm9sbCA9ICh0eXBlb2Ygd2luZG93LnBhZ2VYT2Zmc2V0ID09PSAnbnVtYmVyJykKICAgICAgICAgICAgICAgICAgICAgICAgID8gdGhpcy5nZXRTY3JvbGxCeVBhZ2UgOiB0aGlzLmdldFNjcm9sbEJ5Um9vdDsKICAgICAgICByZXR1cm4gdGhpcy5nZXRTY3JvbGwoKTsKICAgIH0sCiAgICBnZXRTY3JvbGxCeVBhZ2U6IGZ1bmN0aW9uICgpIHsKICAgICAgICByZXR1cm4geyB4OiB3aW5kb3cucGFnZVhPZmZzZXQsIHk6IHdpbmRvdy5wYWdlWU9mZnNldCB9OwogICAgfSwKICAgIGdldFNjcm9sbEJ5Um9vdDogZnVuY3Rpb24gKCkgewogICAgICAgIHJldHVybiB7IHg6IHRoaXMucm9vdC5zY3JvbGxMZWZ0LCB5OiB0aGlzLnJvb3Quc2Nyb2xsVG9wIH07CiAgICB9Cn07Cgp2YXIgRGlzcGF0Y2hhYmxlID0gVS5EaXNwYXRjaGFibGUgPSB7CiAgICBhZGRFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnModHlwZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspCiAgICAgICAgICAgIGlmIChsaXN0ZW5lcnNbaV0gPT09IGxpc3RlbmVyKQogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgIGxpc3RlbmVycy5wdXNoKGxpc3RlbmVyKTsKICAgIH0sCiAgICByZW1vdmVFdmVudExpc3RlbmVyOiBmdW5jdGlvbiAodHlwZSwgbGlzdGVuZXIpIHsKICAgICAgICB2YXIgbGlzdGVuZXJzID0gdGhpcy5nZXRMaXN0ZW5lcnModHlwZSk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaXN0ZW5lcnMubGVuZ3RoOyBpKyspIHsKICAgICAgICAgICAgaWYgKGxpc3RlbmVyc1tpXSA9PT0gbGlzdGVuZXIpIHsKICAgICAgICAgICAgICAgIGxpc3RlbmVycy5zcGxpY2UoaSwgMSk7CiAgICAgICAgICAgICAgICByZXR1cm47CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9LAogICAgZGlzcGF0Y2hFdmVudDogZnVuY3Rpb24gKHR5cGUsIGRhdGEpIHsKICAgICAgICB2YXIgZXZlbnQgPSBuZXcgRGlzcGF0Y2hhYmxlLkV2ZW50KHR5cGUsIGRhdGEpOwogICAgICAgIHZhciBsaXN0ZW5lcnMgPSB0aGlzLmdldExpc3RlbmVycyh0eXBlKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpc3RlbmVycy5sZW5ndGg7IGkrKykKICAgICAgICAgICAgbGlzdGVuZXJzW2ldLmNhbGwodGhpcywgZXZlbnQpOwogICAgICAgIHJldHVybiAhZXZlbnQuZGVmYXVsdFByZXZlbnRlZDsKICAgIH0sCiAgICBnZXRMaXN0ZW5lcnM6IGZ1bmN0aW9uICh0eXBlKSB7CiAgICAgICAgaWYgKCF0aGlzLmhhc093blByb3BlcnR5KCdfbGlzdGVuZXJzTWFwJykpCiAgICAgICAgICAgIHRoaXMuX2xpc3RlbmVyc01hcCA9IHt9OwogICAgICAgIHJldHVybiB0aGlzLl9saXN0ZW5lcnNNYXBbdHlwZV0gfHwgKHRoaXMuX2xpc3RlbmVyc01hcFt0eXBlXSA9IFtdKTsKICAgIH0KfTsKCkRpc3BhdGNoYWJsZS5FdmVudCA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7CiAgICB0aGlzLnR5cGUgPSB0eXBlOwogICAgdGhpcy5kYXRhID0gZGF0YTsKICAgIHRoaXMuZGVmYXVsdFByZXZlbnRlZCA9IGZhbHNlOwp9OwoKZXh0ZW5kKERpc3BhdGNoYWJsZS5FdmVudC5wcm90b3R5cGUsIHsKICAgIHByZXZlbnREZWZhdWx0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5kZWZhdWx0UHJldmVudGVkID0gdHJ1ZTsKICAgIH0KfSk7Cgp2YXIgT2JzZXJ2ZXIgPSBVLk9ic2VydmVyID0gZnVuY3Rpb24gKHRhcmdldCwgdHlwZSwgaGFuZGxlciwgbWV0aG9kKSB7CiAgICB0aGlzLnRhcmdldCA9IHRhcmdldDsKICAgIHRoaXMudHlwZSA9IHR5cGU7CiAgICB0aGlzLmxpc3RlbmVyID0gaGFuZGxlcjsKICAgIGlmIChtZXRob2QpIHsKICAgICAgICB0aGlzLmxpc3RlbmVyID0gKHR5cGVvZiBtZXRob2QgPT09ICdzdHJpbmcnKQogICAgICAgICAgICA/IGZ1bmN0aW9uICgpIHsgcmV0dXJuIGhhbmRsZXJbbWV0aG9kXS5hcHBseShoYW5kbGVyLCBhcmd1bWVudHMpOyB9CiAgICAgICAgICAgIDogZnVuY3Rpb24gKCkgeyByZXR1cm4gaGFuZGxlci5hcHBseShtZXRob2QsIGFyZ3VtZW50cyk7IH07CiAgICB9CiAgICBpZiAoIXRhcmdldC5hZGRFdmVudExpc3RlbmVyICYmIHRhcmdldC5hdHRhY2hFdmVudCkgewogICAgICAgIHZhciBsaXN0ZW5lciA9IHRoaXMubGlzdGVuZXI7CiAgICAgICAgdGhpcy5saXN0ZW5lciA9IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgICAgICByZXR1cm4gbGlzdGVuZXIuY2FsbCh0YXJnZXQsIE9ic2VydmVyLldyYXBwZWRFdmVudC5jcmVhdGUoZXZlbnQpKTsKICAgICAgICB9OwogICAgICAgIHRoaXMuc3RhcnQgPSB0aGlzLnN0YXJ0QXR0YWNoOwogICAgICAgIHRoaXMuc3RvcCA9IHRoaXMuc3RvcEF0dGFjaDsKICAgIH0KICAgIHRoaXMuc3RhcnQoKTsKfTsKCmV4dGVuZChPYnNlcnZlci5wcm90b3R5cGUsIHsKICAgIHN0YXJ0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy50YXJnZXQuYWRkRXZlbnRMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTsKICAgIH0sCiAgICBzdG9wOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy50YXJnZXQucmVtb3ZlRXZlbnRMaXN0ZW5lcih0aGlzLnR5cGUsIHRoaXMubGlzdGVuZXIsIGZhbHNlKTsKICAgIH0sCiAgICBzdGFydEF0dGFjaDogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMudGFyZ2V0LmF0dGFjaEV2ZW50KCdvbicgKyB0aGlzLnR5cGUsIHRoaXMubGlzdGVuZXIpOwogICAgfSwKICAgIHN0b3BBdHRhY2g6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLnRhcmdldC5kZXRhY2hFdmVudCgnb24nICsgdGhpcy50eXBlLCB0aGlzLmxpc3RlbmVyKTsKICAgIH0KfSk7CgpPYnNlcnZlci5XcmFwcGVkRXZlbnQgPSB7CiAgICBjcmVhdGU6IGZ1bmN0aW9uIChldmVudCkgewogICAgICAgIC8qIOS4gOmDqOOBriBJRTgg44Gn44Gu44Kv44Op44OD44K344Ol5a++562WCiAgICAgICAgICogY2Y6IGh0dHA6Ly92aXZpZGNvZGUuaGF0ZW5hYmxvZy5jb20vZW50cnkvaWUvaWU4X3Bvc21lc19jcmFzaCAqLwogICAgICAgIGlmICggZXZlbnQudHlwZSA9PT0gIm1lc3NhZ2UiICkgewogICAgICAgICAgICByZXR1cm4gZXZlbnQ7CiAgICAgICAgfQogICAgICAgIHZhciBlID0gZG9jdW1lbnQuY3JlYXRlRXZlbnRPYmplY3QoZXZlbnQpOwogICAgICAgIGUuX2V2ZW50ID0gZXZlbnQ7CiAgICAgICAgZS50YXJnZXQgPSBldmVudC5zcmNFbGVtZW50OwogICAgICAgIHZhciBzY3JvbGwgPSBWaWV3LmdldFNjcm9sbCgpOwogICAgICAgIGUucGFnZVggPSBldmVudC5jbGllbnRYICsgc2Nyb2xsLnggLSBWaWV3LmNsaWVudExlZnQ7CiAgICAgICAgZS5wYWdlWSA9IGV2ZW50LmNsaWVudFkgKyBzY3JvbGwueSAtIFZpZXcuY2xpZW50VG9wOwogICAgICAgIGUuc3RvcFByb3BhZ2F0aW9uID0gdGhpcy5zdG9wUHJvcGFnYXRpb247CiAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCA9IHRoaXMucHJldmVudERlZmF1bHQ7CiAgICAgICAgcmV0dXJuIGU7CiAgICB9LAogICAgc3RvcFByb3BhZ2F0aW9uOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdGhpcy5fZXZlbnQuY2FuY2VsQnViYmxlID0gdHJ1ZTsKICAgIH0sCiAgICBwcmV2ZW50RGVmYXVsdDogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMuX2V2ZW50LnJldHVyblZhbHVlID0gZmFsc2U7CiAgICB9Cn07Cgp2YXIgSlNPTiA9IFUuSlNPTiA9IHdpbmRvdy5KU09OIHx8IHsKICAgIF90b2tlblJFOiAvW3t9XFtcXSw6XXwtP1xkKyg/OlwuXGQrKT8oPzpbZUVdWystXT9cZCspP1xifFwiKD86W15cdTAwMDAtXHUwMDFmXCJcXF18XFwoPzpbXCJcXFwvYmZucnRdfHVbMC05QS1GYS1mXXs0fSkpKlwifFxiKD86dHJ1ZXxmYWxzZXxudWxsKVxifFxzKy9nLAogICAgX2VzY2FwZUNoYXI6IGZ1bmN0aW9uIChjKSB7CiAgICAgICAgcmV0dXJuICdcXHUnICsgKDB4MTAwMDAgKyBjLmNoYXJDb2RlQXQoMCkpLnRvU3RyaW5nKDE2KS5zdWJzdHJpbmcoMSk7CiAgICB9LAoKICAgIHBhcnNlOiBmdW5jdGlvbiAoanNvbikgewogICAgICAgIGpzb24gPSBTdHJpbmcoanNvbik7CiAgICAgICAgaWYgKGpzb24ucmVwbGFjZShKU09OLl90b2tlblJFLCAnJykgIT09ICcnKQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ludmFsaWQgSlNPTiBzeXRheCcpOwogICAgICAgIHJldHVybiBldmFsKCcoJyArIGpzb24gKyAnKScpOwogICAgfSwKICAgIHN0cmluZ2lmeTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgICAgc3dpdGNoICh0eXBlb2YgdmFsdWUpIHsKICAgICAgICBjYXNlICdzdHJpbmcnOgogICAgICAgICAgICByZXR1cm4gJyInICsgdmFsdWUucmVwbGFjZSgvW1x1MDAwMC1cdTAwMWZcIlxcXHUyMDI4XHUyMDI5XS9nLCBKU09OLl9lc2NhcGVDaGFyKSArICciJzsKICAgICAgICBjYXNlICdudW1iZXInOgogICAgICAgIGNhc2UgJ2Jvb2xlYW4nOgogICAgICAgICAgICByZXR1cm4gJycgKyB2YWx1ZTsKICAgICAgICBjYXNlICdvYmplY3QnOgogICAgICAgICAgICBpZiAoIXZhbHVlKSByZXR1cm4gJ251bGwnOwogICAgICAgICAgICB2YXIgc3RyaW5naWZ5ID0gSlNPTi5zdHJpbmdpZnk7CiAgICAgICAgICAgIHZhciB0eXBlID0gT2JqZWN0LnByb3RvdHlwZS50b1N0cmluZy5jYWxsKHZhbHVlKS5zbGljZSg4LCAtMSk7CiAgICAgICAgICAgIHN3aXRjaCAodHlwZSkgewogICAgICAgICAgICBjYXNlICdTdHJpbmcnOiBjYXNlICdOdW1iZXInOiBjYXNlICdCb29sZWFuJzoKICAgICAgICAgICAgICAgIHJldHVybiBzdHJpbmdpZnkodmFsdWUudmFsdWVPZigpKTsKICAgICAgICAgICAgY2FzZSAnQXJyYXknOgogICAgICAgICAgICAgICAgdmFyIG1lbWJlcnMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdmFsdWUubGVuZ3RoOyBpKyspCiAgICAgICAgICAgICAgICAgICAgbWVtYmVycy5wdXNoKHN0cmluZ2lmeSh2YWx1ZVtpXSkpOwogICAgICAgICAgICAgICAgcmV0dXJuICdbJyArIG1lbWJlcnMuam9pbignLCcpICsgJ10nOwogICAgICAgICAgICBjYXNlICdPYmplY3QnOgogICAgICAgICAgICAgICAgdmFyIG1lbWJlcnMgPSBbXTsKICAgICAgICAgICAgICAgIGZvciAodmFyIGkgaW4gdmFsdWUpCiAgICAgICAgICAgICAgICAgICAgaWYgKHZhbHVlLmhhc093blByb3BlcnR5KGkpKQogICAgICAgICAgICAgICAgICAgICAgICBtZW1iZXJzLnB1c2goc3RyaW5naWZ5KGkpICsgJzonICsgc3RyaW5naWZ5KHZhbHVlW2ldKSk7CiAgICAgICAgICAgICAgICByZXR1cm4gJ3snICsgbWVtYmVycy5qb2luKCcsJykgKyAnfSc7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcmV0dXJuICdudWxsJzsKICAgICAgICB9CiAgICAgICAgcmV0dXJuICdudWxsJzsKICAgIH0KfTsKCnZhciBXaW5kb3dNZXNzZW5nZXIgPSBVLldpbmRvd01lc3NlbmdlciA9IGZ1bmN0aW9uICh3aW4sIHVybCkgewogICAgdGhpcy53aW4gPSB3aW47CiAgICB0aGlzLm9yaWdpbiA9IHVybC5yZXBsYWNlKC9eKGh0dHBzPzpcL1wvW15cLz8jXSspW1xzXFNdKi8sICckMScpOwogICAgdGhpcy5vYnNlcnZlciA9IG5ldyBPYnNlcnZlcih3aW5kb3csICdtZXNzYWdlJywgdGhpcywgJ21lc3NhZ2VIYW5kbGVyJyk7Cn07CgpleHRlbmQoV2luZG93TWVzc2VuZ2VyLCB7CiAgICB1c2VQb3N0TWVzc2FnZTogdHJ1ZSwKICAgIGtleVNlZWQ6IChNYXRoLnJhbmRvbSgpICogMHgxMDAwMCkgPDwgOCwKICAgIGNyZWF0ZUZvckZyYW1lOiBmdW5jdGlvbiAoZnJhbWUsIHVybCkgewogICAgICAgIHZhciB3aW4gPSBmcmFtZS5jb250ZW50V2luZG93OwogICAgICAgIC8qIFdlYktpdCDjgafjga/jg5Xjg6zjg7zjg6DjgZTjgajjgavliKXjga7lkI3liY3jgpLjgaTjgZHjgovlv4XopoHjgYLjgoogKi8KICAgICAgICB3aW4ubmFtZSA9ICgrK3RoaXMua2V5U2VlZCkudG9TdHJpbmcoMzYpICsgJ3wnICsgZ2V0TG9jYXRpb24oKTsKICAgICAgICB3aW4ubG9jYXRpb24ucmVwbGFjZSh1cmwpOwogICAgICAgIHJldHVybiBuZXcgdGhpcyh3aW4sIHVybCk7CiAgICB9Cn0pOwoKZXh0ZW5kKFdpbmRvd01lc3Nlbmdlci5wcm90b3R5cGUsIERpc3BhdGNoYWJsZSk7CmV4dGVuZChXaW5kb3dNZXNzZW5nZXIucHJvdG90eXBlLCB7CiAgICBzZW5kOiBmdW5jdGlvbiAodHlwZSwgZGF0YSkgewogICAgICAgIGlmICh0eXBlb2YgZGF0YSA9PT0gJ3VuZGVmaW5lZCcpIGRhdGEgPSBudWxsOwogICAgICAgIHZhciBtZXNzYWdlID0gJ0hCTWVzc2FnZUAnICsgSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiB0eXBlLCBkYXRhOiBkYXRhIH0pOwogICAgICAgIHRoaXMud2luLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRoaXMub3JpZ2luKTsKICAgIH0sCiAgICBtZXNzYWdlSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdmFyIG9yaWdpbiA9IGV2ZW50Lm9yaWdpbiB8fCBldmVudC51cmkucmVwbGFjZSgvXihodHRwcz86XC9cL1teXC8/I10rKVtcc1xTXSovLCAnJDEnKTsKICAgICAgICBpZiAob3JpZ2luICE9PSB0aGlzLm9yaWdpbiB8fCBldmVudC5zb3VyY2UgIT0gdGhpcy53aW4gfHwKICAgICAgICAgICAgIS9eSEJNZXNzYWdlQC8udGVzdChldmVudC5kYXRhKSkgcmV0dXJuOwogICAgICAgIHZhciBtZXNzYWdlID0gSlNPTi5wYXJzZShldmVudC5kYXRhLnN1YnN0cmluZygxMCkpOwogICAgICAgIHRoaXMuZGlzcGF0Y2hFdmVudChtZXNzYWdlLnR5cGUsIG1lc3NhZ2UuZGF0YSk7CiAgICB9LAogICAgZGVzdHJveTogZnVuY3Rpb24gKCkgewogICAgICAgIHRoaXMub2JzZXJ2ZXIuc3RvcCgpOwogICAgfQp9KTsKCmlmICghd2luZG93LnBvc3RNZXNzYWdlKSB7CgpXaW5kb3dNZXNzZW5nZXIgPSBVLldpbmRvd01lc3NlbmdlciA9IGZ1bmN0aW9uICh3aW4sIHVybCwga2V5KSB7CiAgICB0aGlzLndpbiA9IHdpbjsKICAgIHRoaXMudXJsID0gdXJsLnJlcGxhY2UoLyNbXHNcU10qLywgJycpOwogICAgdGhpcy5rZXkgPSBrZXk7CiAgICBXaW5kb3dNZXNzZW5nZXIuaW5zdGFuY2VzW3RoaXMua2V5XSA9IHRoaXM7CiAgICBpZiAoIVdpbmRvd01lc3Nlbmdlci50aW1lcklkKSBXaW5kb3dNZXNzZW5nZXIuaW5pdCgpOwp9OwoKZXh0ZW5kKFdpbmRvd01lc3NlbmdlciwgewogICAgdXNlUG9zdE1lc3NhZ2U6IGZhbHNlLAogICAgaW5zdGFuY2VzOiB7fSwKICAgIGludGVydmFsOiAyMCwKICAgIHRpbWVySWQ6IDAsCiAgICBjcmVhdGVGb3JGcmFtZTogZnVuY3Rpb24gKGZyYW1lLCB1cmwpIHsKICAgICAgICB2YXIgd2luID0gZnJhbWUuY29udGVudFdpbmRvdzsKICAgICAgICB2YXIga2V5ID0gdGhpcy5tYWtlRk5WSGFzaCh1cmwgKyAnfCcgKyBNYXRoLnJhbmRvbSgpKS50b1N0cmluZygzNik7CiAgICAgICAgd2luLm5hbWUgPSBrZXkgKyAnfCcgKyBnZXRMb2NhdGlvbigpOwogICAgICAgIHdpbi5sb2NhdGlvbi5yZXBsYWNlKHVybCk7CiAgICAgICAgcmV0dXJuIG5ldyB0aGlzKHdpbiwgdXJsLCBrZXkpOwogICAgfSwKICAgIC8qIGh0dHA6Ly9lbi53aWtpcGVkaWEub3JnL3dpa2kvRm93bGVyJUUyJTgwJTkzTm9sbCVFMiU4MCU5M1ZvX2hhc2hfZnVuY3Rpb24gKi8KICAgIG1ha2VGTlZIYXNoOiBmdW5jdGlvbiAoc3RyaW5nKSB7CiAgICAgICAgdmFyIGhhc2ggPSAyMTY2MTM2MjYxOwogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyaW5nLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBoYXNoID0gKChoYXNoICogMTY3Nzc2MTkpIF4gc3RyaW5nLmNoYXJDb2RlQXQoaSkpID4+PiAwOwogICAgICAgIHJldHVybiBoYXNoOwogICAgfSwKICAgIGluaXQ6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmxhc3RGcmFnbWVudCA9IGxvY2F0aW9uLmhhc2g7CiAgICAgICAgdmFyIFdNID0gdGhpczsKICAgICAgICB0aGlzLnRpbWVySWQgPSB3aW5kb3cuc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkgeyBXTS5vYnNlcnZlKCk7IH0sIHRoaXMuaW50ZXJ2YWwpOwogICAgfSwKICAgIG9ic2VydmU6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgZnJhZ21lbnQgPSBsb2NhdGlvbi5oYXNoOwogICAgICAgIGlmIChmcmFnbWVudCA9PT0gdGhpcy5sYXN0RnJhZ21lbnQpIHJldHVybjsKICAgICAgICB2YXIgbWF0Y2ggPSBmcmFnbWVudC5tYXRjaCgvXiNIQk1lc3NhZ2UtKFx3KyktKFteXC9dKylcLyguKykvKTsKICAgICAgICBpZiAoIW1hdGNoKSB7CiAgICAgICAgICAgIHRoaXMubGFzdEZyYWdtZW50ID0gZnJhZ21lbnQ7CiAgICAgICAgICAgIHJldHVybjsKICAgICAgICB9CiAgICAgICAgLyogIiMiIOOBoOOBqOODmuODvOOCuOacgOS4iumDqOOBuOOBruOCueOCr+ODreODvOODq+OBjOeZuueUn+OBmeOCi+OBruOBpyAiI18iIOOBpyAqLwogICAgICAgIHRoaXMubGFzdEZyYWdtZW50ID0gdGhpcy5sYXN0RnJhZ21lbnQgfHwgJyNfJzsKICAgICAgICB2YXIgc2Nyb2xsID0gVmlldy5nZXRTY3JvbGwoKTsKICAgICAgICBsb2NhdGlvbi5yZXBsYWNlKHRoaXMubGFzdEZyYWdtZW50KTsKICAgICAgICB3aW5kb3cuc2Nyb2xsVG8oc2Nyb2xsLngsIHNjcm9sbC55KTsKICAgICAgICB2YXIgbWVzc2VuZ2VyID0gdGhpcy5pbnN0YW5jZXNbbWF0Y2hbMV1dOwogICAgICAgIGlmICghbWVzc2VuZ2VyKSByZXR1cm47CiAgICAgICAgdmFyIHR5cGUgPSBkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbMl0pOwogICAgICAgIHZhciBkYXRhID0gSlNPTi5wYXJzZShkZWNvZGVVUklDb21wb25lbnQobWF0Y2hbM10pKTsKICAgICAgICBtZXNzZW5nZXIuZGlzcGF0Y2hFdmVudCh0eXBlLCBkYXRhKTsKICAgIH0KfSk7CgpleHRlbmQoV2luZG93TWVzc2VuZ2VyLnByb3RvdHlwZSwgRGlzcGF0Y2hhYmxlKTsKZXh0ZW5kKFdpbmRvd01lc3Nlbmdlci5wcm90b3R5cGUsIHsKICAgIHNlbmQ6IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7CiAgICAgICAgaWYgKHR5cGVvZiBkYXRhID09PSAndW5kZWZpbmVkJykgZGF0YSA9IG51bGw7CiAgICAgICAgdmFyIHVybCA9IHRoaXMudXJsICsgJyNIQk1lc3NhZ2UtJyArIHRoaXMua2V5ICsgJy0nICsKICAgICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KHR5cGUpICsgJy8nICsKICAgICAgICAgICAgICAgICAgZW5jb2RlVVJJQ29tcG9uZW50KEpTT04uc3RyaW5naWZ5KGRhdGEpKTsKICAgICAgICB0cnkgewogICAgICAgICAgICB0aGlzLndpbi5sb2NhdGlvbi5yZXBsYWNlKHVybCk7CiAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgdGhpcy53aW4ubG9jYXRpb24uaHJlZiA9IHVybDsKICAgICAgICB9CiAgICB9LAogICAgZGVzdHJveTogZnVuY3Rpb24gKCkgewogICAgICAgIGRlbGV0ZSBXaW5kb3dNZXNzZW5nZXIuaW5zdGFuY2VzW3RoaXMua2V5XTsKICAgIH0KfSk7Cgp9IC8qIFdpbmRvd01lc3NlbmdlciBpbXBsZW1lbnRhdGlvbiB3aXRoIGZyYWdtZW50IGlkZW50aWZpZXIgKi8KCkIuQm9va21hcmtCdXR0b24gPSBmdW5jdGlvbiAobGluaykgewogICAgdGhpcy51cmwgPSBsaW5rLmdldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstdXJsJykgfHwKICAgICAgICAgICAgICAgQi5Cb29rbWFya0J1dHRvbi5leHRyYWN0VVJMKGxpbmsuaHJlZikgfHwKICAgICAgICAgICAgICAgQi5Cb29rbWFya0J1dHRvbi5nZXRDdXJyZW50VVJMKCk7CiAgICB0aGlzLmxpbmsgPSBsaW5rOwogICAgdGhpcy5tb2RlID0gQi5Cb29rbWFya0J1dHRvbi5pc1RvdWNoQnJvd3NlcgogICAgICAgID8gJ2dvdG8tdG91Y2gnIDogdGhpcy5saW5rLmdldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstbW9kZScpOwogICAgLyogSUUgNyDjga/jg4fjg5Xjgqnjg6vjg4jjga7jgrvjgq3jg6Xjg6rjg4bjgqPoqK3lrprjgavjgojjgorjg5Xjg6zjg7zjg6DlhoXjgafjga7jg5Hjg43jg6vjga7li5XkvZzjgasKICAgICAqIOaUr+manOOCkuOBjeOBn+OBmeOBruOBp+OAgeODleODrOODvOODoOWGheOBp+OBr+ODneODg+ODl+OCouODg+ODl+OCkumWi+OBj+OBk+OBqOOCkuW8t+WItuOBmeOCi+OAggogICAgICovCiAgICBpZiAoIVdpbmRvd01lc3Nlbmdlci51c2VQb3N0TWVzc2FnZSAmJgogICAgICAgIC9cYk1TSUUgN1xiLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpICYmCiAgICAgICAgd2luZG93LnNlbGYgIT0gd2luZG93LnRvcCkgewogICAgICAgIHRoaXMubW9kZSA9ICdwb3B1cCc7CiAgICB9CiAgICB0aGlzLnNldHVwKCk7Cn07CgpleHRlbmQoQi5Cb29rbWFya0J1dHRvbiwgewogICAgaW50ZXJ2YWw6IDQyOCwgLyogV2VsY29tZSB0byBTaGlidXlhLmpzISAqLwogICAgdGltZXJJZDogMCwKICAgIHNldHVwOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMudGltZXJJZCkgcmV0dXJuOwogICAgICAgIHZhciBCdXR0b24gPSB0aGlzOwogICAgICAgIHRoaXMudGltZXJJZCA9IHdpbmRvdy5zZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7IEJ1dHRvbi50cnlDcmVhdGUoKTsgfSwgdGhpcy5pbnRlcnZhbCk7CiAgICAgICAgdGhpcy50cnlDcmVhdGUoKTsKICAgIH0sCiAgICBsYXN0TGlua0NvdW50OiAwLAogICAgdHJ5Q3JlYXRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGxpbmtzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2EnKTsKICAgICAgICB2YXIgbGlua0NvdW50ID0gbGlua3MubGVuZ3RoOwogICAgICAgIGlmIChsaW5rQ291bnQgPT09IHRoaXMubGFzdExpbmtDb3VudCkgcmV0dXJuOwogICAgICAgIHZhciBidXR0b25MaW5rcyA9IFtdOwogICAgICAgIHZhciBjbGFzc1JFID0gLyg/Ol58XHMpaGF0ZW5hLWJvb2ttYXJrLWJ1dHRvbig/OlxzfCQpLzsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGxpbmtDb3VudDsgaSsrKQogICAgICAgICAgICBpZiAoY2xhc3NSRS50ZXN0KGxpbmtzW2ldLmNsYXNzTmFtZSkgJiYKICAgICAgICAgICAgICAgICFsaW5rc1tpXS5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGF0ZW5hLWJvb2ttYXJrLWluaXRpYWxpemVkJykpCiAgICAgICAgICAgICAgICBidXR0b25MaW5rcy5wdXNoKGxpbmtzW2ldKTsKICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGJ1dHRvbkxpbmtzLmxlbmd0aDsgaSsrKQogICAgICAgICAgICBuZXcgQi5Cb29rbWFya0J1dHRvbihidXR0b25MaW5rc1tpXSk7CiAgICAgICAgdGhpcy5sYXN0TGlua0NvdW50ID0gbGlua3MubGVuZ3RoOwogICAgfSwKICAgIGV4dHJhY3RVUkw6IGZ1bmN0aW9uIChlbnRyeVVSTCkgewogICAgICAgIGlmICghZW50cnlVUkwpIHJldHVybiBudWxsOwogICAgICAgIHZhciBtYXRjaCA9IGVudHJ5VVJMLm1hdGNoKC9eaHR0cDpcL1wvYlwuaGF0ZW5hXC5uZVwuanBcL2VudHJ5XC8oPzphZGRcLyk/KC4rKS8pOwogICAgICAgIGlmICghbWF0Y2gpIHJldHVybiBudWxsOwogICAgICAgIHZhciB1cmwgPSBtYXRjaFsxXTsKICAgICAgICB2YXIgcGFydHMgPSB1cmwubWF0Y2goL14oPzpodHRwcz8oPzooOil8KCUzQSkpfChzXC8pKT8vKTsKICAgICAgICBpZiAocGFydHNbMl0pIHsKICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIHJldHVybiBkZWNvZGVVUklDb21wb25lbnQodXJsKTsKICAgICAgICAgICAgfSBjYXRjaCAoZXgpIHsKICAgICAgICAgICAgICAgIHJldHVybiB1bmVzY2FwZSh1cmwpOwogICAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmICghcGFydHNbMV0pCiAgICAgICAgICAgIHVybCA9IHBhcnRzWzNdID8gJ2h0dHBzOi8vJyArIHVybC5zdWJzdHJpbmcoMikgOiAnaHR0cDovLycgKyB1cmw7CiAgICAgICAgcmV0dXJuIHVybC5yZXBsYWNlKC8lMjMvZywgJyMnKTsKICAgIH0sCiAgICBnZXRDdXJyZW50VVJMOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIHVybCA9IGdldExvY2F0aW9uKCk7CiAgICAgICAgdmFyIGNhbm9uaWNhbFVSTCA9IHRoaXMuZ2V0Q2Fub25pY2FsVVJMKCk7CiAgICAgICAgaWYgKGNhbm9uaWNhbFVSTCkgewogICAgICAgICAgICB2YXIgaW5kZXggPSB1cmwuaW5kZXhPZignIycpOwogICAgICAgICAgICBpZiAoaW5kZXggPj0gMCAmJiBjYW5vbmljYWxVUkwuaW5kZXhPZignIycpIDwgMCkKICAgICAgICAgICAgICAgIGNhbm9uaWNhbFVSTCArPSB1cmwuc3Vic3RyaW5nKGluZGV4KTsKICAgICAgICAgICAgdXJsID0gY2Fub25pY2FsVVJMOwogICAgICAgIH0KICAgICAgICByZXR1cm4gdXJsOwogICAgfSwKICAgIGdldENhbm9uaWNhbFVSTDogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciBsaW5rcyA9IGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCdsaW5rJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBsaW5rcy5sZW5ndGg7IGkrKykgewogICAgICAgICAgICBpZiAobGlua3NbaV0ucmVsLnRvTG93ZXJDYXNlKCkgIT09ICdjYW5vbmljYWwnIHx8ICFsaW5rc1tpXS5ocmVmKSBjb250aW51ZTsKICAgICAgICAgICAgLyogSUUg44GnIGhyZWYg44OX44Ot44OR44OG44Kj44GM57W25a++IFVSTCDjgavop6PmsbrjgZXjgozjgarjgYTjgZPjgajjgYzjgYLjgosgKi8KICAgICAgICAgICAgdmFyIGEgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJyk7CiAgICAgICAgICAgIGEuaHJlZiA9IGxpbmtzW2ldLmhyZWY7CiAgICAgICAgICAgIHJldHVybiBhLmNsb25lTm9kZShmYWxzZSkuaHJlZjsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIG51bGw7CiAgICB9LAogICAgaXNUb3VjaEJyb3dzZXI6IC9cYig/OmlQaG9uZXxpUG9kKTt8IEFuZHJvaWQgLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpLAogICAgZm9yY2VkTGF5b3V0OiAnJwp9KTsKCmV4dGVuZChCLkJvb2ttYXJrQnV0dG9uLnByb3RvdHlwZSwgewogICAgc2V0dXA6IGZ1bmN0aW9uICgpIHsKICAgICAgICB2YXIgbGF5b3V0ID0gQi5Cb29rbWFya0J1dHRvbi5mb3JjZWRMYXlvdXQgfHwgdGhpcy5saW5rLmdldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstbGF5b3V0Jyk7CiAgICAgICAgaWYgKGxheW91dCA9PT0gJ3NpbXBsZScpIHsKICAgICAgICAgICAgdGhpcy5saW5rLnNldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstaW5pdGlhbGl6ZWQnLCAnMScpOwogICAgICAgICAgICB0aGlzLm9ic2VydmVyID0gbmV3IE9ic2VydmVyKHRoaXMubGluaywgJ2NsaWNrJywgdGhpcywgJ2NsaWNrSGFuZGxlcicpOwogICAgICAgICAgICB0aGlzLmJ1dHRvbiA9IHRoaXMubGluazsKICAgICAgICAgICAgLyog44Oq44Oz44Kv44Gu5YaF5a6544GM55S75YOP44Gy44Go44Gk44Gu44G/44Gq44KJ44Gd44Gu55S75YOP44KS5Z+65rqW44Gr44OR44ON44Or44KS6KGo56S6ICovCiAgICAgICAgICAgIHZhciBpbWFnZXMgPSB0aGlzLmxpbmsuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2ltZycpOwogICAgICAgICAgICB0aGlzLmFuY2hvciA9IChpbWFnZXMubGVuZ3RoID09PSAxKSA/IGltYWdlc1swXSA6IHRoaXMubGluazsKICAgICAgICAgICAgaWYgKCFpc0xvY2FsICYmICEvXmh0dHBzPzpcL1wvYlwuaGF0ZW5hXC5uZVwuanBcLyg/IWFydGljbGVzKD8hW1x3LV0pKS8udGVzdChnZXRMb2NhdGlvbigpKSkgewogICAgICAgICAgICAgICAgdGhpcy5pbWFnZSA9IG5ldyBJbWFnZSgpOwogICAgICAgICAgICAgICAgdGhpcy5pbWFnZS5zcmMgPSBCLmFwaU9yaWdpbiArICcvZW50cnkvYnV0dG9uLz91cmw9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLnVybCkgKyAnJmxheW91dD1zaW1wbGUmZm9ybWF0PWltYWdlJzsKICAgICAgICAgICAgfQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHZhciBjb25maWcgPSB7CiAgICAgICAgICAgICAgICB2ZXJ0aWNhbDogeyBoZWlnaHQ6IDUwIH0sCiAgICAgICAgICAgICAgICAnc2ltcGxlLWJhbGxvb24nICA6IHsgd2lkdGg6IDcwLCAgaGVpZ2h0OiAyMCB9LAogICAgICAgICAgICAgICAgJ3N0YW5kYXJkLWJhbGxvb24nOiB7IHdpZHRoOiAxMzAsIGhlaWdodDogMjAgfSwKICAgICAgICAgICAgICAgICdzdGFuZGFyZC1ub2JhbGxvb24nOiB7IHdpZHRoOiA4MCwgaGVpZ2h0OiAyMCB9LAogICAgICAgICAgICAgICAgJ3ZlcnRpY2FsLWJhbGxvb24nOiB7IHdpZHRoOiA4MCwgIGhlaWdodDogNjAgfQogICAgICAgICAgICB9OwogICAgICAgICAgICB2YXIgd2lkdGggPSA1MCwgaGVpZ2h0ID0gMjA7CiAgICAgICAgICAgIGlmIChjb25maWdbbGF5b3V0XSkgewogICAgICAgICAgICAgICAgd2lkdGggID0gY29uZmlnW2xheW91dF1bJ3dpZHRoJ10gIHx8IHdpZHRoOwogICAgICAgICAgICAgICAgaGVpZ2h0ID0gY29uZmlnW2xheW91dF1bJ2hlaWdodCddIHx8IGhlaWdodDsKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGlzLmZyYW1lID0gRSgnaWZyYW1lJywgeyBjbGFzc05hbWU6ICdoYXRlbmEtYm9va21hcmstYnV0dG9uLWZyYW1lJywgdGl0bGU6IHRoaXMubGluay50aXRsZSwgZnJhbWVCb3JkZXI6IDAsIHNjcm9sbGluZzogJ25vJywgYWxsb3dUcmFuc3BhcmVuY3k6IHRydWUsIHdpZHRoOiB3aWR0aCwgaGVpZ2h0OiBoZWlnaHQsIHNyYzonamF2YXNjcmlwdDpmYWxzZScgfSk7CiAgICAgICAgICAgIHRoaXMuZnJhbWUuc3R5bGUuY3NzVGV4dCA9ICd3aWR0aDogJyArIHdpZHRoICsgJ3B4OyBoZWlnaHQ6ICcgKyBoZWlnaHQgKyAncHg7JzsKICAgICAgICAgICAgdGhpcy5saW5rLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKHRoaXMuZnJhbWUsIHRoaXMubGluayk7CgogICAgICAgICAgICB2YXIgYnV0dG9uVVJMID0gQi5hcGlPcmlnaW4gKyAnL2VudHJ5L2J1dHRvbi8/dXJsPScgKyBlbmNvZGVVUklDb21wb25lbnQodGhpcy51cmwpOwogICAgICAgICAgICBpZiAobGF5b3V0ICYmIGxheW91dCAhPT0gJ3N0YW5kYXJkJykKICAgICAgICAgICAgICAgIGJ1dHRvblVSTCArPSAnJmxheW91dD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KGxheW91dCk7CiAgICAgICAgICAgIHZhciBsYW5nID0gdGhpcy5saW5rLmdldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstbGFuZycpOwogICAgICAgICAgICBpZiAobGFuZykKICAgICAgICAgICAgICAgIGJ1dHRvblVSTCArPSAnJmxhbmc9JyArIGVuY29kZVVSSUNvbXBvbmVudChsYW5nKTsKICAgICAgICAgICAgaWYgKHRoaXMubW9kZSA9PT0gJ3BvcHVwJykKICAgICAgICAgICAgICAgIGJ1dHRvblVSTCArPSAnJm1vZGU9JyArIGVuY29kZVVSSUNvbXBvbmVudCh0aGlzLm1vZGUpOwogICAgICAgICAgICB0aGlzLm1lc3NlbmdlciA9IFdpbmRvd01lc3Nlbmdlci5jcmVhdGVGb3JGcmFtZSh0aGlzLmZyYW1lLCBidXR0b25VUkwpOwogICAgICAgICAgICB0aGlzLm9ic2VydmVyID0gbmV3IE9ic2VydmVyKHRoaXMubWVzc2VuZ2VyLCAnY2xpY2snLCB0aGlzLCAnY2xpY2tIYW5kbGVyJyk7CiAgICAgICAgICAgIHRoaXMuX3Jlc2l6ZU9ic2VydmVyID0gbmV3IE9ic2VydmVyKHRoaXMubWVzc2VuZ2VyLCAicmVzaXplIiwgdGhpcywgInJlc2l6ZU1lc3NhZ2VIYW5kbGVyIik7CiAgICAgICAgICAgIHRoaXMuYnV0dG9uID0gdGhpcy5mcmFtZTsKICAgICAgICAgICAgdGhpcy5hbmNob3IgPSB0aGlzLmZyYW1lOwogICAgICAgIH0KICAgIH0sCiAgICBnZXRUaXRsZTogZnVuY3Rpb24gKCkgewogICAgICAgIHZhciB0aXRsZSA9IHRoaXMubGluay5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGF0ZW5hLWJvb2ttYXJrLXRpdGxlJyk7CiAgICAgICAgaWYgKCF0aXRsZSkgewogICAgICAgICAgICB0aXRsZSA9IHRoaXMubGluay5nZXRBdHRyaWJ1dGUoJ2RhdGEtaGF0ZW5hLWJvb2ttYXJrLWVzY2FwZWQtdGl0bGUnKTsKICAgICAgICAgICAgaWYgKHRpdGxlKQogICAgICAgICAgICAgICAgdHJ5IHsgdGl0bGUgPSBkZWNvZGVVUklDb21wb25lbnQodGl0bGUpOyB9IGNhdGNoIChleCkge30KICAgICAgICB9CiAgICAgICAgaWYgKCF0aXRsZSAmJiB0aGlzLnVybC5yZXBsYWNlKC8jLiovLCAnJykgPT09IGdldExvY2F0aW9uKCkucmVwbGFjZSgvIy4qLywgJycpKQogICAgICAgICAgICB0aXRsZSA9IGRvY3VtZW50LnRpdGxlOwogICAgICAgIHJldHVybiB0aXRsZTsKICAgIH0sCiAgICB0b2dnbGVQYW5lbDogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghdGhpcy5wYW5lbCkKICAgICAgICAgICAgdGhpcy5wYW5lbCA9IG5ldyBCLkJvb2ttYXJrUGFuZWwodGhpcy51cmwsIHRoaXMuZ2V0VGl0bGUoKSk7CiAgICAgICAgaWYgKHRoaXMucGFuZWwuaXNTaG93bikgewogICAgICAgICAgICB0aGlzLnBhbmVsLmhpZGUoKTsKICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB2YXIgcG9zaXRpb24gPSB0aGlzLmxpbmsuZ2V0QXR0cmlidXRlKCdkYXRhLWhhdGVuYS1ib29rbWFyay1wb3NpdGlvbicpOwogICAgICAgICAgICB2YXIgaGlkZUJnID0gdGhpcy5saW5rLmdldEF0dHJpYnV0ZSgnZGF0YS1oYXRlbmEtYm9va21hcmstaGlkZS1iZycpOwogICAgICAgICAgICB2YXIgaGlkZUJhY2tncm91bmQgPSAhaGlkZUJnIHx8IGhpZGVCZy50b0xvd2VyQ2FzZSgpICE9PSAnZmFsc2UnOwogICAgICAgICAgICB0aGlzLnBhbmVsLnNob3codGhpcy5hbmNob3IsIHBvc2l0aW9uLCBoaWRlQmFja2dyb3VuZCk7CiAgICAgICAgfQogICAgfSwKICAgIGdvdG9Ub3VjaEVudHJ5OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGVudHJ5VVJMID0gQi5vcmlnaW4gKyAnL2VudHJ5LnRvdWNoLyc7CiAgICAgICAgdmFyIHVybE1hdGNoID0gdGhpcy51cmwubWF0Y2goL15odHRwKHMpPzpcL1wvKFtcc1xTXSopJC8pOwogICAgICAgIGlmICh1cmxNYXRjaCkKICAgICAgICAgICAgZW50cnlVUkwgKz0gKHVybE1hdGNoWzFdID8gJ3MvJyA6ICcnKSArIHVybE1hdGNoWzJdOwogICAgICAgIGVsc2UKICAgICAgICAgICAgZW50cnlVUkwgKz0gdGhpcy51cmw7CiAgICAgICAgbG9jYXRpb24uaHJlZiA9IGVudHJ5VVJMLnJlcGxhY2UoLyMvZywgJyUyMycpOwogICAgfSwKICAgIGdvdG9Ub3VjaEJvb2ttYXJrbGV0OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGJvb2ttYXJrbGV0VVJMID0gQi5vcmlnaW4gKyAnL2Jvb2ttYXJrbGV0LnRvdWNoP3VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRoaXMudXJsKTsKICAgICAgICB2YXIgdGl0bGUgPSB0aGlzLmdldFRpdGxlKCk7CiAgICAgICAgaWYgKHRpdGxlKQogICAgICAgICAgICBib29rbWFya2xldFVSTCArPSAnJmJ0aXRsZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRpdGxlKTsKICAgICAgICBsb2NhdGlvbi5ocmVmID0gYm9va21hcmtsZXRVUkw7CiAgICB9LAogICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBpZiAoKGV2ZW50LndoaWNoIHx8IGV2ZW50LmJ1dHRvbiB8fCAwKSA+IDEpIHJldHVybjsKICAgICAgICBpZiAoZXZlbnQuc3RvcFByb3BhZ2F0aW9uKSBldmVudC5zdG9wUHJvcGFnYXRpb24oKTsKICAgICAgICBpZiAoZXZlbnQucHJldmVudERlZmF1bHQpIGV2ZW50LnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgc3dpdGNoICh0aGlzLm1vZGUpIHsKICAgICAgICBjYXNlICdwb3B1cCc6CiAgICAgICAgICAgIEIuQm9va21hcmtQYW5lbC5vcGVuUG9wdXAodGhpcy51cmwsIHRoaXMuZ2V0VGl0bGUoKSk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGNhc2UgJ2dvdG8tdG91Y2gnOgogICAgICAgICAgICB0aGlzLmdvdG9Ub3VjaEVudHJ5KCk7CiAgICAgICAgICAgIGJyZWFrOwogICAgICAgIGRlZmF1bHQ6CiAgICAgICAgICAgIHRoaXMudG9nZ2xlUGFuZWwoKTsKICAgICAgICB9CiAgICB9LAogICAgcmVzaXplTWVzc2FnZUhhbmRsZXI6IGZ1bmN0aW9uIChldnQpIHsKICAgICAgICB2YXIgd2lkdGggPSBldnQuZGF0YS53aWR0aCArICIiOwogICAgICAgIHZhciBoZWlnaHQgPSBldnQuZGF0YS5oZWlnaHQgKyAiIjsKICAgICAgICBpZiAoL15cZCskLy50ZXN0KHdpZHRoKSkgdGhpcy5mcmFtZS5zdHlsZS53aWR0aCA9IHdpZHRoICsgInB4IjsKICAgICAgICBpZiAoL15cZCskLy50ZXN0KGhlaWdodCkpIHRoaXMuZnJhbWUuc3R5bGUuaGVpZ2h0ID0gaGVpZ2h0ICsgInB4IjsKICAgIH0sCiAgICBkZXN0cm95OiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKHRoaXMub2JzZXJ2ZXIpIHRoaXMub2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgIGlmICh0aGlzLl9yZXNpemVPYnNlcnZlcikgdGhpcy5fcmVzaXplT2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgIGlmICh0aGlzLm1lc3NlbmdlcikgdGhpcy5tZXNzZW5nZXIuZGVzdHJveSgpOwogICAgICAgIGlmICh0aGlzLnBhbmVsKSB0aGlzLnBhbmVsLmRlc3Ryb3koKTsKICAgICAgICBpZiAodGhpcy5idXR0b24gJiYgdGhpcy5idXR0b24ucGFyZW50Tm9kZSkKICAgICAgICAgICAgdGhpcy5idXR0b24ucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aGlzLmJ1dHRvbik7CiAgICB9Cn0pOwoKQi5Cb29rbWFya1BhbmVsID0gZnVuY3Rpb24gKHVybCwgdGl0bGUpIHsKICAgIHRoaXMudXJsID0gdXJsOwogICAgdGhpcy50aXRsZSA9IHRpdGxlIHx8ICcnOwogICAgdGhpcy5pc1Nob3duID0gZmFsc2U7CiAgICB0aGlzLndpZHRoID0gMzY1OwogICAgdGhpcy5oZWlnaHQgPSAxNjA7CiAgICB0aGlzLmZpeGVkVG8gPSAndG9wJzsKICAgIHRoaXMuaGlkZGVuRmxhc2hlcyA9IFtdOwogICAgdGhpcy5jbGlja09ic2VydmVyID0gbmV3IE9ic2VydmVyKGRvY3VtZW50LCAnY2xpY2snLCB0aGlzLCAnY2xpY2tIYW5kbGVyJyk7CiAgICB0aGlzLmNsaWNrT2JzZXJ2ZXIuc3RvcCgpOwogICAgdGhpcy5vYnNlcnZlcnMgPSBbdGhpcy5jbGlja09ic2VydmVyXTsKICAgIHRoaXMuc2V0dXAoKTsKfTsKCmV4dGVuZChCLkJvb2ttYXJrUGFuZWwsIHsKICAgIGN1cnJlbnRQYW5lbDogbnVsbCwKICAgIG1ha2VQYW5lbFVSTDogZnVuY3Rpb24gKHVybCwgdGl0bGUpIHsKICAgICAgICB2YXIgcGFuZWxVUkwgPSBCLm9yaWdpbiArICcvZW50cnkvcGFuZWwvP3VybD0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHVybCk7CiAgICAgICAgaWYgKHRpdGxlKQogICAgICAgICAgICBwYW5lbFVSTCArPSAnJmJ0aXRsZT0nICsgZW5jb2RlVVJJQ29tcG9uZW50KHRpdGxlKTsKICAgICAgICByZXR1cm4gcGFuZWxVUkw7CiAgICB9LAogICAgb3BlblBvcHVwOiBmdW5jdGlvbiAodXJsLCB0aXRsZSkgewogICAgICAgIHZhciBwYW5lbFVSTCA9IHRoaXMubWFrZVBhbmVsVVJMKHVybCwgdGl0bGUpOwogICAgICAgIHZhciB3aW4gPSB3aW5kb3cub3BlbihwYW5lbFVSTCwgJ2hhdGVuYV9ib29rbWFya19wYW5lbF9wb3B1cCcsICd3aWR0aD0zNjUsaGVpZ2h0PTIyMCxtZW51YmFyPW5vLHRvb2xiYXI9bm8scmVzaXphYmxlPXllcycpOwogICAgfSwKICAgIGhhc0NvbW1vblN0eWxlOiBmYWxzZSwKICAgIHNldHVwQ29tbW9uU3R5bGU6IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5oYXNDb21tb25TdHlsZSkgcmV0dXJuOwogICAgICAgIHRoaXMuaGFzQ29tbW9uU3R5bGUgPSB0cnVlOwogICAgICAgIHZhciByZXNldENTU0RlY2xhcmF0aW9ucyA9CiAgICAgICAgICAgICdtYXJnaW46IDA7IHBhZGRpbmc6IDA7IGJvcmRlcjogbm9uZTsgJyArCiAgICAgICAgICAgICdwb3NpdGlvbjogc3RhdGljOyBmbG9hdDogbm9uZTsgd2lkdGg6IGF1dG87IGhlaWdodDogYXV0bzsgJyArCiAgICAgICAgICAgICdsaW5lLWhlaWdodDogMTsgdmVydGljYWwtYWxpZ246IGJhc2VsaW5lOyAnICsKICAgICAgICAgICAgJ2NvbG9yOiAjMjIyOyBiYWNrZ3JvdW5kOiBub25lOyAnICsKICAgICAgICAgICAgJ2ZvbnQtc3R5bGU6IG5vcm1hbDsgZm9udC13ZWlnaHQ6bm9ybWFsOyBmb250LXNpemU6IG1lZGl1bTsgJyArCiAgICAgICAgICAgICd0ZXh0LWluZGVudDogMDsgdGV4dC1hbGlnbjogbGVmdDsgdGV4dC1kZWNvcmF0aW9uOiBub25lOyAnICsKICAgICAgICAgICAgJ2xldHRlci1zcGFjaW5nOiBub3JtYWw7IHdvcmQtc3BhY2luZzogbm9ybWFsOyB3aGl0ZS1zcGFjZTogbm9ybWFsOyc7CiAgICAgICAgdmFyIHJlc2V0Q1NTVGV4dCA9CiAgICAgICAgICAgICcuaGF0ZW5hLWJvb2ttYXJrLWJvb2ttYXJrLXBhbmVsLCAnICsKICAgICAgICAgICAgJy5oYXRlbmEtYm9va21hcmstYm9va21hcmstcGFuZWwgKiAnICsKICAgICAgICAgICAgJ3snICsgcmVzZXRDU1NEZWNsYXJhdGlvbnMgKyAnfSc7CiAgICAgICAgdHJ5IHsKICAgICAgICAgICAgdmFyIHN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc3R5bGUnKTsKICAgICAgICAgICAgc3R5bGUudHlwZSA9ICd0ZXh0L2Nzcyc7CiAgICAgICAgICAgIHN0eWxlLmFwcGVuZENoaWxkKGRvY3VtZW50LmNyZWF0ZVRleHROb2RlKHJlc2V0Q1NTVGV4dCkpOwogICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaGVhZCcpWzBdLmFwcGVuZENoaWxkKHN0eWxlKTsKICAgICAgICB9IGNhdGNoIChleCkgewogICAgICAgICAgICBkb2N1bWVudC5jcmVhdGVTdHlsZVNoZWV0KCkuY3NzVGV4dCA9IHJlc2V0Q1NTVGV4dDsKICAgICAgICB9CiAgICB9LAogICAgbmVlZHNSZWJhc2U6IG51bGwsCiAgICBnZXRCYXNlUG9zaXRpb246IGZ1bmN0aW9uICgpIHsKICAgICAgICBpZiAodGhpcy5uZWVkc1JlYmFzZSA9PT0gbnVsbCkgewogICAgICAgICAgICB2YXIgc3R5bGUgPSB3aW5kb3cuZ2V0Q29tcHV0ZWRTdHlsZQogICAgICAgICAgICAgICAgPyBnZXRDb21wdXRlZFN0eWxlKGRvY3VtZW50LmJvZHksIG51bGwpCiAgICAgICAgICAgICAgICA6IGRvY3VtZW50LmJvZHkuY3VycmVudFN0eWxlOwogICAgICAgICAgICB0aGlzLm5lZWRzUmViYXNlID0gISFzdHlsZSAmJiBzdHlsZS5wb3NpdGlvbiAhPT0gJ3N0YXRpYyc7CiAgICAgICAgfQogICAgICAgIHJldHVybiB0aGlzLm5lZWRzUmViYXNlID8gVmlldy5nZXRFbGVtZW50UmVjdChkb2N1bWVudC5ib2R5KSA6IHsgeDogMCwgeTogMCB9OwogICAgfQp9KTsKCmV4dGVuZChCLkJvb2ttYXJrUGFuZWwucHJvdG90eXBlLCB7CiAgICBzZXR1cDogZnVuY3Rpb24gKCkgewogICAgICAgIC8qIHZhciBmcmFtZVRpdGxlID0gKHRoaXMudGl0bGUgPyAn44COJyArIHRoaXMudGl0bGUgKyAn44CPJyA6ICfjgZPjga7jgqjjg7Pjg4jjg6rjg7wnKSArICfjgpLjga/jgabjgarjg5bjg4Pjgq/jg57jg7zjgq/jgavov73liqAnOyAqLwogICAgICAgIHZhciBmcmFtZVRpdGxlID0gKHRoaXMudGl0bGUgPyAnXHUzMDBFJyArIHRoaXMudGl0bGUgKyAnXHUzMDBGJyA6ICdcdTMwNTNcdTMwNkVcdTMwQThcdTMwRjNcdTMwQzhcdTMwRUFcdTMwRkMnKSArICdcdTMwOTJcdTMwNkZcdTMwNjZcdTMwNkFcdTMwRDZcdTMwQzNcdTMwQUZcdTMwREVcdTMwRkNcdTMwQUZcdTMwNkJcdThGRkRcdTUyQTAnOwogICAgICAgIHRoaXMucGFuZWwgPSBFKCdkaXYnLCB7IGNsYXNzTmFtZTogJ2hhdGVuYS1ib29rbWFyay1ib29rbWFyay1wYW5lbCcgfSwKICAgICAgICAgICAgdGhpcy5sb2FkaW5nID0gRSgnZGl2JywgbnVsbCwgRSgnc3BhbicsIG51bGwsICdOb3cgTG9hZGluZy4uLicpKSwKICAgICAgICAgICAgdGhpcy5jb250ZW50ID0gRSgnZGl2JywgbnVsbCwKICAgICAgICAgICAgICAgIHRoaXMuZnJhbWUgPSBFKCdpZnJhbWUnLCB7IHRpdGxlOiBmcmFtZVRpdGxlLCBzY3JvbGxpbmc6ICdubycsIGZyYW1lQm9yZGVyOiAwLCBhbGxvd1RyYW5zcGFyZW5jeTogdHJ1ZSwgc3JjOiAnamF2YXNjcmlwdDpmYWxzZScgfSkKICAgICAgICAgICAgKQogICAgICAgICk7CiAgICAgICAgdGhpcy5zZXR1cFN0eWxlKCk7CiAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZCh0aGlzLnBhbmVsKTsKICAgICAgICB2YXIgcGFuZWxVUkwgPSBCLkJvb2ttYXJrUGFuZWwubWFrZVBhbmVsVVJMKHRoaXMudXJsLCB0aGlzLnRpdGxlKTsKICAgICAgICB0aGlzLm1lc3NlbmdlciA9IFdpbmRvd01lc3Nlbmdlci5jcmVhdGVGb3JGcmFtZSh0aGlzLmZyYW1lLCBwYW5lbFVSTCk7CiAgICAgICAgdGhpcy5vYnNlcnZlcnMucHVzaCgKICAgICAgICAgICAgLyogZnJhbWUg44GL44KJ44Gu44Oh44OD44K744O844K45Y+X5L+h5aSx5pWX5pmC44Gu5L+d6Zm6ICovCiAgICAgICAgICAgIG5ldyBPYnNlcnZlcih0aGlzLmZyYW1lLCAnbG9hZCcsIHRoaXMsICdzaG93Q29udGVudCcpLAogICAgICAgICAgICBuZXcgT2JzZXJ2ZXIodGhpcy5tZXNzZW5nZXIsICdyZWFkeScsIHRoaXMsICdzaG93Q29udGVudCcpLAogICAgICAgICAgICBuZXcgT2JzZXJ2ZXIodGhpcy5tZXNzZW5nZXIsICdyZXNpemUnLCB0aGlzLCAncmVzaXplTWVzc2FnZUhhbmRsZXInKQogICAgICAgICk7CiAgICB9LAogICAgc2V0dXBTdHlsZTogZnVuY3Rpb24gKCkgewogICAgICAgIEIuQm9va21hcmtQYW5lbC5zZXR1cENvbW1vblN0eWxlKCk7CiAgICAgICAgdmFyIHNpemUgPSAnd2lkdGg6ICcgKyB0aGlzLndpZHRoICsgJ3B4OyBoZWlnaHQ6ICcgKyB0aGlzLmhlaWdodCArICdweDsnOwogICAgICAgIHRoaXMucGFuZWwuc3R5bGUuY3NzVGV4dCA9ICdwb3NpdGlvbjogYWJzb2x1dGU7IHotaW5kZXg6IDEwMDAyOyBkaXNwbGF5OiBub25lOyAnICsgc2l6ZTsKICAgICAgICB0aGlzLmxvYWRpbmcuc3R5bGUuY3NzVGV4dCA9ICdiYWNrZ3JvdW5kLWNvbG9yOiAjZmZmOyBib3JkZXI6IDNweCBzb2xpZCAjMmM2ZWJkOyAtbW96LWJvcmRlci1yYWRpdXM6IDVweDsgLXdlYmtpdC1ib3JkZXItcmFkaXVzOiA1cHg7IGJvcmRlci1yYWRpdXM6IDVweDsgdGV4dC1hbGlnbjogY2VudGVyOyB3aWR0aDogJyArICh0aGlzLndpZHRoIC0gNikgKyAncHg7IGhlaWdodDogJyArICh0aGlzLmhlaWdodCAtIDYpICsgJ3B4Oyc7CiAgICAgICAgdGhpcy5sb2FkaW5nLmZpcnN0Q2hpbGQuc3R5bGUuY3NzVGV4dCA9ICdiYWNrZ3JvdW5kOiB1cmwoIicgKyBCLnN0YXRpY09yaWdpbiArICcvaW1hZ2VzL2xvYWRpbmcuZ2lmIikgbGVmdCBjZW50ZXIgbm8tcmVwZWF0OyBwYWRkaW5nLWxlZnQ6IDIzcHg7IGZvbnQtc2l6ZTogMC44NWVtOyBwb3NpdGlvbjogcmVsYXRpdmU7IHRvcDogJyArICh0aGlzLmhlaWdodCAvIDIgLSAxMCkgKyAncHg7JzsKICAgICAgICB0aGlzLmNvbnRlbnQuc3R5bGUuY3NzVGV4dCA9ICdkaXNwbGF5OiBub25lOyc7CiAgICAgICAgdGhpcy5mcmFtZS5zdHlsZS5jc3NUZXh0ID0gJ2Rpc3BsYXk6IGJsb2NrOyAnICsgc2l6ZTsKICAgIH0sCiAgICBzaG93OiBmdW5jdGlvbiAoYW5jaG9yLCBwb3NpdGlvbiwgaGlkZUJhY2tncm91bmQpIHsKICAgICAgICBpZiAodGhpcy5pc1Nob3duKSByZXR1cm47CiAgICAgICAgaWYgKEIuQm9va21hcmtQYW5lbC5jdXJyZW50UGFuZWwpCiAgICAgICAgICAgIEIuQm9va21hcmtQYW5lbC5jdXJyZW50UGFuZWwuaGlkZSgpOwogICAgICAgIGlmIChhbmNob3IpCiAgICAgICAgICAgIHRoaXMuYW5jaG9yVG8oYW5jaG9yLCBwb3NpdGlvbik7CiAgICAgICAgdGhpcy5wYW5lbC5zdHlsZS5kaXNwbGF5ID0gJyc7CiAgICAgICAgdGhpcy5pc1Nob3duID0gdHJ1ZTsKICAgICAgICB0aGlzLmNsaWNrT2JzZXJ2ZXIuc3RhcnQoKTsKICAgICAgICBpZiAoaGlkZUJhY2tncm91bmQpCiAgICAgICAgICAgIHRoaXMuaGlkZUZsYXNoZXMoKTsKICAgICAgICBCLkJvb2ttYXJrUGFuZWwuY3VycmVudFBhbmVsID0gdGhpczsKICAgICAgICBpZiAoIXRoaXMubG9hZGluZykKICAgICAgICAgICAgdGhpcy5tZXNzZW5nZXIuc2VuZCgnbm90aWZ5c2l6ZScpOwogICAgfSwKICAgIGhpZGVGbGFzaGVzOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgdmFyIGZsYXNoZXMgPSBbXTsKICAgICAgICB2YXIgZW1iZWRzID0gZG9jdW1lbnQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ2VtYmVkJyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIGVtYmVkOyBlbWJlZCA9IGVtYmVkc1tpXTsgaSsrKQogICAgICAgICAgICBpZiAoZW1iZWQudHlwZSA9PT0gJ2FwcGxpY2F0aW9uL3gtc2hvY2t3YXZlLWZsYXNoJykKICAgICAgICAgICAgICAgIGZsYXNoZXMucHVzaChlbWJlZCk7CiAgICAgICAgdmFyIG9iamVjdHMgPSBkb2N1bWVudC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnb2JqZWN0Jyk7CiAgICAgICAgZm9yICh2YXIgaSA9IDAsIG9iamVjdDsgb2JqZWN0ID0gb2JqZWN0c1tpXTsgaSsrKQogICAgICAgICAgICBpZiAob2JqZWN0LnR5cGUgPT09ICdhcHBsaWNhdGlvbi94LXNob2Nrd2F2ZS1mbGFzaCcgfHwKICAgICAgICAgICAgICAgIChvYmplY3QuY2xhc3NpZCB8fCAnJykudG9Mb3dlckNhc2UoKSA9PT0gJ2Nsc2lkOmQyN2NkYjZlLWFlNmQtMTFjZi05NmI4LTQ0NDU1MzU0MDAwMCcpCiAgICAgICAgICAgICAgICBmbGFzaGVzLnB1c2gob2JqZWN0KTsKICAgICAgICBpZiAoIWZsYXNoZXMubGVuZ3RoKSByZXR1cm47CiAgICAgICAgdmFyIHBhbmVsUmVjdCA9IFZpZXcuZ2V0RWxlbWVudFJlY3QodGhpcy5wYW5lbCk7CiAgICAgICAgdmFyIGxlZnQgPSBwYW5lbFJlY3QueDsKICAgICAgICB2YXIgdG9wID0gcGFuZWxSZWN0Lnk7CiAgICAgICAgdmFyIHJpZ2h0ID0gcGFuZWxSZWN0LnggKyBwYW5lbFJlY3Qud2lkdGg7CiAgICAgICAgdmFyIGJvdHRvbSA9IHBhbmVsUmVjdC55ICsgTWF0aC5tYXgocGFuZWxSZWN0LmhlaWdodCwgMzAwKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgZmxhc2g7IGZsYXNoID0gZmxhc2hlc1tpXTsgaSsrKSB7CiAgICAgICAgICAgIHZhciByZWN0ID0gVmlldy5nZXRFbGVtZW50UmVjdChmbGFzaCk7CiAgICAgICAgICAgIGlmIChyZWN0LnggKyByZWN0LndpZHRoIDwgbGVmdCB8fCByaWdodCA8IHJlY3QueCB8fAogICAgICAgICAgICAgICAgcmVjdC55ICsgcmVjdC5oZWlnaHQgPCB0b3AgfHwgYm90dG9tIDwgcmVjdC55KQogICAgICAgICAgICAgICAgY29udGludWU7CiAgICAgICAgICAgIGZsYXNoLnN0eWxlLnZpc2liaWxpdHkgPSAnaGlkZGVuJzsKICAgICAgICAgICAgdGhpcy5oaWRkZW5GbGFzaGVzLnB1c2goZmxhc2gpOwogICAgICAgIH0KICAgIH0sCiAgICBzaG93Q29udGVudDogZnVuY3Rpb24gKCkgewogICAgICAgIGlmICghdGhpcy5sb2FkaW5nKSByZXR1cm47CiAgICAgICAgdGhpcy5wYW5lbC5yZW1vdmVDaGlsZCh0aGlzLmxvYWRpbmcpOwogICAgICAgIHRoaXMubG9hZGluZyA9IG51bGw7CiAgICAgICAgdGhpcy5jb250ZW50LnN0eWxlLmRpc3BsYXkgPSAnJzsKICAgIH0sCiAgICBoaWRlOiBmdW5jdGlvbiAoKSB7CiAgICAgICAgaWYgKCF0aGlzLmlzU2hvd24pIHJldHVybjsKICAgICAgICB0aGlzLnBhbmVsLnN0eWxlLmRpc3BsYXkgPSAnbm9uZSc7CiAgICAgICAgdGhpcy5pc1Nob3duID0gZmFsc2U7CiAgICAgICAgdGhpcy5jbGlja09ic2VydmVyLnN0b3AoKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgZmxhc2g7IGZsYXNoID0gdGhpcy5oaWRkZW5GbGFzaGVzW2ldOyBpKyspCiAgICAgICAgICAgIGZsYXNoLnN0eWxlLnZpc2liaWxpdHkgPSAnJzsKICAgICAgICB0aGlzLmhpZGRlbkZsYXNoZXMgPSBbXTsKICAgICAgICBCLkJvb2ttYXJrUGFuZWwuY3VycmVudFBhbmVsID0gbnVsbDsKICAgIH0sCiAgICByZXNpemU6IGZ1bmN0aW9uICh3aWR0aCwgaGVpZ2h0KSB7CiAgICAgICAgaWYgKHdpZHRoID4gMCkgewogICAgICAgICAgICB0aGlzLnBhbmVsLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnOwogICAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLndpZHRoID0gd2lkdGggKyAncHgnOwogICAgICAgICAgICB0aGlzLndpZHRoID0gd2lkdGg7CiAgICAgICAgfQogICAgICAgIGlmIChoZWlnaHQgPiAwKSB7CiAgICAgICAgICAgIGlmICh0aGlzLmZpeGVkVG8gPT09ICdib3R0b20nKQogICAgICAgICAgICAgICAgdGhpcy5wYW5lbC5zdHlsZS50b3AgPSBwYXJzZUZsb2F0KHRoaXMucGFuZWwuc3R5bGUudG9wKSArIHRoaXMuaGVpZ2h0IC0gaGVpZ2h0ICsgJ3B4JzsKICAgICAgICAgICAgdGhpcy5wYW5lbC5zdHlsZS5oZWlnaHQgPSBoZWlnaHQgKyAncHgnOwogICAgICAgICAgICB0aGlzLmZyYW1lLnN0eWxlLmhlaWdodCA9IGhlaWdodCArICdweCc7CiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gaGVpZ2h0OwogICAgICAgIH0KICAgIH0sCiAgICBhbmNob3JUbzogZnVuY3Rpb24gKGFuY2hvciwgcG9zaXRpb24pIHsKICAgICAgICB2YXIgcmVjdCA9IFZpZXcuZ2V0RWxlbWVudFJlY3QoYW5jaG9yKTsKICAgICAgICB2YXIgaXNMZWZ0ID0gcG9zaXRpb24gJiYgcG9zaXRpb24uaW5kZXhPZignbGVmdCcpID49IDA7CiAgICAgICAgdmFyIGlzVG9wID0gcG9zaXRpb24gJiYgcG9zaXRpb24uaW5kZXhPZigndG9wJykgPj0gMDsKICAgICAgICBpZiAoIXBvc2l0aW9uKSB7CiAgICAgICAgICAgIHZhciBzaXplID0gVmlldy5nZXRXaW5kb3dTaXplKCk7CiAgICAgICAgICAgIHZhciBzY3JvbGwgPSBWaWV3LmdldFNjcm9sbCgpOwogICAgICAgICAgICBpc0xlZnQgPSAoc2Nyb2xsLnggKyBzaXplLndpZHRoKSAtIHJlY3QueCA8IHRoaXMud2lkdGggJiYKICAgICAgICAgICAgICAgICAgICAgKHJlY3QueCArIHJlY3Qud2lkdGgpIC0gc2Nyb2xsLnggPj0gdGhpcy53aWR0aDsKICAgICAgICAgICAgdmFyIGggPSBNYXRoLm1heCh0aGlzLmhlaWdodCwgMzAwKTsKICAgICAgICAgICAgaXNUb3AgPSAoc2Nyb2xsLnkgKyBzaXplLmhlaWdodCkgLSAocmVjdC55ICsgcmVjdC5oZWlnaHQpIDwgaCAmJgogICAgICAgICAgICAgICAgICAgIHJlY3QueSAtIHNjcm9sbC55ID49IGg7CiAgICAgICAgfQogICAgICAgIHZhciBsZWZ0ID0gaXNMZWZ0ID8gcmVjdC54ICsgcmVjdC53aWR0aCAtIHRoaXMud2lkdGggOiByZWN0Lng7CiAgICAgICAgdmFyIHRvcCA9IGlzVG9wID8gcmVjdC55IC0gdGhpcy5oZWlnaHQgLSAyIDogcmVjdC55ICsgcmVjdC5oZWlnaHQgKyAyOwogICAgICAgIHZhciBiYXNlID0gQi5Cb29rbWFya1BhbmVsLmdldEJhc2VQb3NpdGlvbigpOwogICAgICAgIHRoaXMucGFuZWwuc3R5bGUubGVmdCA9IChNYXRoLm1heChsZWZ0LCAyKSAtIGJhc2UueCkgKyAncHgnOwogICAgICAgIHRoaXMucGFuZWwuc3R5bGUudG9wID0gKE1hdGgubWF4KHRvcCwgMikgLSBiYXNlLnkpICsgJ3B4JzsKICAgICAgICB0aGlzLmZpeGVkVG8gPSBpc1RvcCA/ICdib3R0b20nIDogJ3RvcCc7CiAgICB9LAogICAgY2xpY2tIYW5kbGVyOiBmdW5jdGlvbiAoZXZlbnQpIHsKICAgICAgICBmb3IgKHZhciBub2RlID0gZXZlbnQudGFyZ2V0OyBub2RlOyBub2RlID0gbm9kZS5wYXJlbnROb2RlKQogICAgICAgICAgICBpZiAobm9kZSA9PT0gdGhpcy5wYW5lbCkKICAgICAgICAgICAgICAgIHJldHVybjsKICAgICAgICB0aGlzLmhpZGUoKTsKICAgIH0sCiAgICByZXNpemVNZXNzYWdlSGFuZGxlcjogZnVuY3Rpb24gKGV2ZW50KSB7CiAgICAgICAgdGhpcy5yZXNpemUoZXZlbnQuZGF0YS53aWR0aCB8fCAtMSwgZXZlbnQuZGF0YS5oZWlnaHQgfHwgLTEpOwogICAgfSwKICAgIGRlc3Ryb3k6IGZ1bmN0aW9uICgpIHsKICAgICAgICB0aGlzLmhpZGUoKTsKICAgICAgICBmb3IgKHZhciBpID0gMCwgb2JzZXJ2ZXI7IG9ic2VydmVyID0gdGhpcy5vYnNlcnZlcnNbaV07IGkrKykKICAgICAgICAgICAgb2JzZXJ2ZXIuc3RvcCgpOwogICAgICAgIHRoaXMubWVzc2VuZ2VyLmRlc3Ryb3koKTsKICAgICAgICBpZiAodGhpcy5wYW5lbC5wYXJlbnROb2RlKQogICAgICAgICAgICB0aGlzLnBhbmVsLnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQodGhpcy5wYW5lbCk7CiAgICB9Cn0pOwoKfSkoSGF0ZW5hKTsKCkhhdGVuYS5Cb29rbWFyay5Cb29rbWFya0J1dHRvbi5zZXR1cCgpOwo=" type="text/javascript" charset="utf-8" async="async"></script>

    <a class="github-button" href="https://github.com/future-architect/coding-standards" data-icon="octicon-star" data-count-href="/future-architect/coding-standards/stargazers" data-count-api="/repos/future-architect/coding-standards#stargazers_count" data-count-aria-label="# stargazers on GitHub" aria-label="Star future-architect/coding-standards on GitHub">Star</a>
</div>
<nav id="TOC">
<ul>
<li><a href="#はじめに"><span class="toc-section-number">1</span> はじめに</a></li>
<li><a href="#規約の重要性"><span class="toc-section-number">2</span> 規約の重要性</a><ul>
<li><a href="#コーディングの心得"><span class="toc-section-number">2.1</span> コーディングの心得</a><ul>
<li><a href="#見やすさを重視せよ"><span class="toc-section-number">2.1.1</span> 見やすさを重視せよ</a></li>
<li><a href="#ネーミングはわかりやすく"><span class="toc-section-number">2.1.2</span> ネーミングはわかりやすく</a></li>
<li><a href="#サンプルを鵜呑みにしない"><span class="toc-section-number">2.1.3</span> サンプルを鵜呑みにしない</a></li>
<li><a href="#同じコードは二度書かない"><span class="toc-section-number">2.1.4</span> 同じコードは二度書かない</a></li>
<li><a href="#役割は一つに"><span class="toc-section-number">2.1.5</span> 役割は一つに</a></li>
</ul></li>
</ul></li>
<li><a href="#ネーミング規約"><span class="toc-section-number">3</span> ネーミング規約</a><ul>
<li><a href="#全般"><span class="toc-section-number">3.1</span> 全般</a></li>
<li><a href="#パッケージ"><span class="toc-section-number">3.2</span> パッケージ</a></li>
<li><a href="#クラス"><span class="toc-section-number">3.3</span> クラス</a></li>
<li><a href="#メソッド"><span class="toc-section-number">3.4</span> メソッド</a></li>
<li><a href="#引数"><span class="toc-section-number">3.5</span> 引数</a></li>
<li><a href="#変数全般"><span class="toc-section-number">3.6</span> 変数全般</a></li>
<li><a href="#ローカル変数"><span class="toc-section-number">3.7</span> ローカル変数</a></li>
</ul></li>
<li><a href="#コーディング規約"><span class="toc-section-number">4</span> コーディング規約</a><ul>
<li><a href="#全般-1"><span class="toc-section-number">4.1</span> 全般</a></li>
<li><a href="#フォーマット"><span class="toc-section-number">4.2</span> フォーマット</a></li>
<li><a href="#コメント"><span class="toc-section-number">4.3</span> コメント</a></li>
<li><a href="#インポート"><span class="toc-section-number">4.4</span> インポート</a></li>
<li><a href="#コンストラクタ"><span class="toc-section-number">4.5</span> コンストラクタ</a></li>
<li><a href="#メソッド-1"><span class="toc-section-number">4.6</span> メソッド</a></li>
<li><a href="#クラスメソッド"><span class="toc-section-number">4.7</span> クラスメソッド</a></li>
<li><a href="#変数全般-1"><span class="toc-section-number">4.8</span> 変数全般</a></li>
<li><a href="#インスタンス変数"><span class="toc-section-number">4.9</span> インスタンス変数</a></li>
<li><a href="#クラス変数"><span class="toc-section-number">4.10</span> クラス変数</a></li>
<li><a href="#ローカル変数-1"><span class="toc-section-number">4.11</span> ローカル変数</a></li>
<li><a href="#引数-1"><span class="toc-section-number">4.12</span> 引数</a></li>
<li><a href="#継承"><span class="toc-section-number">4.13</span> 継承</a></li>
<li><a href="#インナークラス"><span class="toc-section-number">4.14</span> インナークラス</a></li>
<li><a href="#メンバー順序"><span class="toc-section-number">4.15</span> メンバー順序</a></li>
<li><a href="#インスタンス"><span class="toc-section-number">4.16</span> インスタンス</a></li>
<li><a href="#制御構造"><span class="toc-section-number">4.17</span> 制御構造</a></li>
<li><a href="#文字列操作"><span class="toc-section-number">4.18</span> 文字列操作</a></li>
<li><a href="#数値"><span class="toc-section-number">4.19</span> 数値</a></li>
<li><a href="#日付"><span class="toc-section-number">4.20</span> 日付</a></li>
<li><a href="#三項演算子"><span class="toc-section-number">4.21</span> 三項演算子</a></li>
<li><a href="#コレクション"><span class="toc-section-number">4.22</span> コレクション</a></li>
<li><a href="#ラムダ式メソッド参照コンストラクタ参照"><span class="toc-section-number">4.23</span> ラムダ式・メソッド参照・コンストラクタ参照</a></li>
<li><a href="#実質的finaleffectively-final"><span class="toc-section-number">4.24</span> 実質的final（effectively final）</a></li>
<li><a href="#stream-api"><span class="toc-section-number">4.25</span> Stream API</a></li>
<li><a href="#optional"><span class="toc-section-number">4.26</span> Optional</a></li>
<li><a href="#ストリームinputstream-outputstream"><span class="toc-section-number">4.27</span> ストリーム（InputStream OutputStream）</a></li>
<li><a href="#リソースの解放"><span class="toc-section-number">4.28</span> リソースの解放</a></li>
<li><a href="#例外"><span class="toc-section-number">4.29</span> 例外</a></li>
<li><a href="#ガベージコレクション"><span class="toc-section-number">4.30</span> ガベージコレクション</a></li>
</ul></li>
<li><a href="#コメント規約"><span class="toc-section-number">5</span> コメント規約</a><ul>
<li><a href="#よいコメントの鉄則"><span class="toc-section-number">5.1</span> よいコメントの鉄則</a></li>
<li><a href="#javaコメント3種類の使い分け"><span class="toc-section-number">5.2</span> Javaコメント（3種類）の使い分け</a></li>
</ul></li>
<li><a href="#パフォーマンス"><span class="toc-section-number">6</span> パフォーマンス</a><ul>
<li><a href="#stream-api-1"><span class="toc-section-number">6.1</span> Stream API</a></li>
<li><a href="#ラムダ式メソッド参照コンストラクタ参照-1"><span class="toc-section-number">6.2</span> ラムダ式・メソッド参照・コンストラクタ参照</a></li>
<li><a href="#文字列連結"><span class="toc-section-number">6.3</span> 文字列連結</a><ul>
<li><a href="#文字列連結繰り返し"><span class="toc-section-number">6.3.1</span> 文字列連結（繰り返し）</a></li>
<li><a href="#文字列連結定数"><span class="toc-section-number">6.3.2</span> 文字列連結（定数）</a></li>
</ul></li>
<li><a href="#listの種類"><span class="toc-section-number">6.4</span> Listの種類</a></li>
<li><a href="#オートボクシング"><span class="toc-section-number">6.5</span> オートボクシング</a><ul>
<li><a href="#オートボクシング例"><span class="toc-section-number">6.5.1</span> オートボクシング例</a></li>
<li><a href="#オートボクシング性能"><span class="toc-section-number">6.5.2</span> オートボクシング性能</a></li>
</ul></li>
<li><a href="#stringからintegerlongへの変換"><span class="toc-section-number">6.6</span> StringからInteger・Longへの変換</a></li>
<li><a href="#stringからintlongへの変換"><span class="toc-section-number">6.7</span> Stringからint・longへの変換</a></li>
<li><a href="#bigdecimalのzeroとの比較"><span class="toc-section-number">6.8</span> BigDecimalのZEROとの比較</a></li>
</ul></li>
</ul>
</nav>
<hr />
<p>本コーディング規約は、世の中のシステム開発プロジェクトのために無償で提供致します。<br />
ただし、掲載内容および利用に際して発生した問題、それに伴う損害については、フューチャーアーキテクト株式会社は一切の責務を負わないものとします。<br />
また、掲載している情報は予告なく変更することがございますので、あらかじめご了承下さい。</p>
<h1 id="はじめに"><span class="header-section-number">1</span> はじめに</h1>
<p>一般に利用・参照されているJavaコーディング規約やガイドラインを以下に示す。本規約の作成においても、下記規約類を参照・抜粋している。</p>
<table>
<colgroup>
<col style="width: 49%"></col>
<col style="width: 25%"></col>
<col style="width: 25%"></col>
</colgroup>
<thead>
<tr class="header">
<th>規約</th>
<th>著作者</th>
<th>URL</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Code Conventions for the Java Programming Language</td>
<td>Sun Microsystems</td>
<td><a href="http://www.oracle.com/technetwork/java/codeconvtoc-136057.html" class="uri">http://www.oracle.com/technetwork/java/codeconvtoc-136057.html</a></td>
</tr>
<tr class="even">
<td>Writing Robust Java Code</td>
<td>Scott W. Ambler</td>
<td><a href="http://www.ambysoft.com/downloads/javaCodingStandards.pdf" class="uri">http://www.ambysoft.com/downloads/javaCodingStandards.pdf</a></td>
</tr>
<tr class="odd">
<td>オブジェクト倶楽部版 Javaコーディング標準</td>
<td>オブジェクト倶楽部</td>
<td><a href="http://objectclub.jp/community/codingstandard/CodingStd.pdf" class="uri">http://objectclub.jp/community/codingstandard/CodingStd.pdf</a></td>
</tr>
<tr class="even">
<td>電通国際情報際サービス版 Javaコーディング規約2004</td>
<td>電通国際情報サービス</td>
<td><a href="http://objectclub.jp/community/codingstandard/JavaCodingStandard2004.pdf" class="uri">http://objectclub.jp/community/codingstandard/JavaCodingStandard2004.pdf</a></td>
</tr>
<tr class="odd">
<td>JJGuideline （Java - J2EE Conventions and Guidelines）</td>
<td>Stephan.J &amp; JCS Team</td>
<td><a href="http://www.fedict.belgium.be/sites/default/files/downloads/Java_J2EE_conventions_and_guidelines_EN.pdf" class="uri">http://www.fedict.belgium.be/sites/default/files/downloads/Java_J2EE_conventions_and_guidelines_EN.pdf</a></td>
</tr>
<tr class="even">
<td>Google Java Style (非公式和訳)</td>
<td>Google</td>
<td><a href="https://kazurof.github.io/GoogleJavaStyle-ja/" class="uri">https://kazurof.github.io/GoogleJavaStyle-ja/</a></td>
</tr>
<tr class="odd">
<td>Acroquest Technology Javaコーディング規約</td>
<td>Acroquest Technology</td>
<td><a href="https://www.acroquest.co.jp/webworkshop/javacordingrule/Acroquest_JavaCodingStandard_6_7.pdf" class="uri">https://www.acroquest.co.jp/webworkshop/javacordingrule/Acroquest_JavaCodingStandard_6_7.pdf</a></td>
</tr>
</tbody>
</table>
<p>※ Sun Microsystemsの規約はJava草創期から一応の標準という位置づけだったが、オブジェクト指向、及び、その開発環境の普及・発展によって、設計やコーディングにおいて、直接的に有用な知識や豊富な指針を含むような優れた規約や、ツールなどによる機械的な準拠チェックと連携する規約が普及してきている。</p>
<h1 id="規約の重要性"><span class="header-section-number">2</span> 規約の重要性</h1>
<p>標準としての規約を定義し、遵守することの重要性を以下に示す。</p>
<ul>
<li>ソフトウェアメンテナンスにおける、可読性・保守性・拡張性の向上<br />
</li>
<li>問題を起こしやすい実装を未然に回避することによる、品質・生産性の向上<br />
</li>
<li>標準規約を通して得られる一般的な実装知識やノウハウ（＝学習効果）</li>
</ul>
<h2 id="コーディングの心得"><span class="header-section-number">2.1</span> コーディングの心得</h2>
<p>長いプログラムを記述すること（ステップ数）によって生産性が評価されたのは、過去の時代の出来事である。現在は、クラスやメソッドの役割が明確で、ロジックが読みやすく、保守性に優れたプログラムを記述することが評価される。コーディング規約は、コードの書き方に関する一種のパターンと考えることもでき、コードの保守性を向上させる具体的な方法を示している。したがって、規約の一つ一つの意図を理解し、守ることが重要になる。しかし、保守性に優れたコードを作成するためには、コーディング規約を守ることに加えて、良いコードを記述するための基本的な心構えをしっかり心に留めておく必要がある。以下では、その心得について述べる。</p>
<p>【コーディングの心得5か条】<br />
1. 見やすさを重視せよ<br />
2. ネーミングはわかりやすく<br />
3. サンプルを鵜呑みにしない<br />
4. 同じコードを二度書かない<br />
5. 役割は一つに</p>
<h3 id="見やすさを重視せよ"><span class="header-section-number">2.1.1</span> 見やすさを重視せよ</h3>
<p>「良いコード」の基本は、「他の人が読んでもわかりやすいと感じられるコード」。コードの見やすさは、フォーマットはもちろん、ロジックの簡潔さやAPIの常識的な使い方などから生まれる。コーディングにあたっては、常に他の人の視点を意識しながら、見やすさに気を配って記述する必要がある。例えば、自分で記述したコードであっても、しばらくたってから読み返してみると理解に時間がかかった経験は誰にもあるはず。「3日前に書いたコードは他人のコードと同じ」ということもよく言われる。見やすさを重視することは、他の人のためだけでなく自分のためにもなる。コードを読んでもすぐに理解できないような実装は、再考（リファクタリング）の必要がある。</p>
<h3 id="ネーミングはわかりやすく"><span class="header-section-number">2.1.2</span> ネーミングはわかりやすく</h3>
<p>コーディングでは、様々な変数やメソッドなどにネーミング（名前付け）する必要がある。ネーミングとは、本来、その対象の本質を表すような名前を考える作業である。大変難易度の高い作業だが、一方で適当に行ってもコードの動作は変わらないため、人によっては手を抜きがちとなる。しかし、ネーミングの良し悪しは、コードの可読性に非常に大きな影響を及ぼす。例えば、「C0001」というクラス名があるとする。これでは、何を表すクラスなのかすぐにはわからないだろう。また、「int p = 5000;」という記述があるとする。プログラマに聞くと、変数名pは価格(Price)の略だと言うのだが、それならば略さずに、「int price = 5000;」としたほうが分かりやすいはずである。「ネーミングはわかりやすく」の背景には、読んで内容が理解できるという意味で、文章のようなプログラミングを行う、という考え方に基づく。</p>
<h3 id="サンプルを鵜呑みにしない"><span class="header-section-number">2.1.3</span> サンプルを鵜呑みにしない</h3>
<p>サンプルコードを活用すること自体は、著作権等を侵害しなければ問題ない。問題なのは、その内容や背景を理解しないまま、サンプルコードだけを鵜呑みにして、「おまじない」として表面的に適用してしまうことである。コードを「おまじない」ととらえていては、サンプルコードの間違いを気づかないまま適用してしまうこともある。例えば、ストリームのクローズ処理を行っていないサンプルコードであっても、それに気づかずに自分のコードに適用してしまい、後で思わぬ障害を引き起こすという可能性がある。サンプルコードは、そこで説明する内容に絞ったコードが多いため、このような例はよく見られる。また、サンプルコードをそのまま適用した結果、自分が記述すべきコードには必要のないコードが含まれてしまう場合もある。その場合、コードの可読性を下げる原因となる。自分のコードは、自分で深く理解して記述すべきである。</p>
<h3 id="同じコードは二度書かない"><span class="header-section-number">2.1.4</span> 同じコードは二度書かない</h3>
<p>コードをコピー・ペーストしていませんか？コピー・ペーストしてしまうと、何らかの修正をする際に、全ての個所に同じ修正をする羽目になる。同じコードが現れるようならまとめて一つにし、外に出してコールするような書き方にすべきである。同じコードをまとめる作業は、どちらかといえば、コーディング時よりリファクタリング（ソフトウェアの外部的振る舞いを変更せずに内部構造を改善する作業）で行われることが多い。しかし、コーディング時からできるだけ気をつけておきたいことでもある。</p>
<h3 id="役割は一つに"><span class="header-section-number">2.1.5</span> 役割は一つに</h3>
<p>メソッドの役割が明確で、かつ1つであれば単体テストが行いやすくなる。つまり、コードの「試験性」が高まる。また、役割が一つであれば、後でコードを変更する際に修正箇所がわかりやすいため、障害修正に要する時間が短くなる。つまり、コードの「保守性」があがることになる。例えば、「チェックをして実行する」機能を実現するために、checkAndDo()メソッドが存在したとする。この場合、このメソッドはcheck()メソッドとdo()メソッドに分割すべきである。なぜなら、checkAndDo()メソッドのcheck()ロジックに誤りがあった場合、do()メソッドに書かれる内容まで把握する必要が生じるためである。分割してあれば、check()メソッドだけの変更で済む。このことはクラスの設計にもあてはまる。</p>
<h1 id="ネーミング規約"><span class="header-section-number">3</span> ネーミング規約</h1>
<h2 id="全般"><span class="header-section-number">3.1</span> 全般</h2>
<ul>
<li><p>大文字・小文字の違いで名前を区別しない。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">int</span> carNumber;
<span class="kw">private</span> <span class="dt">int</span> trainNumber;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">int</span> num;
<span class="kw">private</span> <span class="dt">int</span> Num;</code></pre></div></li>
</ul>
<h2 id="パッケージ"><span class="header-section-number">3.2</span> パッケージ</h2>
<ul>
<li>パッケージ名はすべて小文字にする<br />
</li>
<li>パッケージ名は意味のある名前にする<br />
</li>
<li>サブパッケージ名の重複は可能</li>
</ul>
<h2 id="クラス"><span class="header-section-number">3.3</span> クラス</h2>
<ul>
<li><p>クラス名は単語の先頭を大文字にする<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Entry {</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> entry {</code></pre></div></li>
<li><p>インターフェース名はクラス名に準ずる</p></li>
</ul>
<h2 id="メソッド"><span class="header-section-number">3.4</span> メソッド</h2>
<ul>
<li><p>コンストラクタと同じ名前のメソッドはつくらない</p></li>
<li><p>メソッド名は区切りのみ大文字にする<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String <span class="fu">getName</span>() {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String <span class="fu">getname</span>() {
    <span class="co">//・・・</span>
}
<span class="kw">public</span> String <span class="fu">GETNAME</span>() {
    <span class="co">//・・・</span>
}</code></pre></div></li>
<li><p>変換メソッド名は「&quot;<code>to</code>&quot;+オブジェクト名」にする<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String <span class="fu">toString</span>() {</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String <span class="fu">string</span>() {</code></pre></div></li>
<li>ゲッターメソッド名は「&quot;<code>get</code>&quot;+属性名」にする<br />
型が<code>boolean</code>の場合は「&quot;<code>is</code>&quot;+属性名」にする<br />
</li>
<li><p>セッターメソッド名は「&quot;<code>set</code>&quot;+属性名」にする</p></li>
<li><p><code>boolean</code>変数を返すメソッド名は<code>true</code>/<code>false</code>の状態がわかるようにする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">isAsleep</span>(){
}
<span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">exists</span>(){
}
<span class="kw">public</span> <span class="dt">boolean</span> <span class="fu">hasExpired</span>(){
}</code></pre></div></li>
</ul>
<h2 id="引数"><span class="header-section-number">3.5</span> 引数</h2>
<ul>
<li><p>メソッドのパラメータ名とインスタンス変数名を一緒にしない<br />
ただし、アクセサメソッドやコンストラクタなど、統合開発環境の機能により自動生成するものに関しては可とする。<br />
アンダースコア　<code>_</code>　をつけての区別は原則禁止とする。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">double</span> <span class="fu">calc</span>(<span class="dt">double</span> rate) {
    <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">value</span> * rate;
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">double</span> <span class="fu">calc</span>(<span class="dt">double</span> value) {
    <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">value</span> * value;
}

<span class="kw">public</span> <span class="dt">double</span> <span class="fu">calc</span>(<span class="dt">double</span> _value) {
    <span class="kw">return</span> <span class="kw">this</span>.<span class="fu">value</span> * _value;
}</code></pre></div></li>
</ul>
<h2 id="変数全般"><span class="header-section-number">3.6</span> 変数全般</h2>
<ul>
<li><p><code>boolean</code>変数は<code>true</code>/<code>false</code> の状態がわかるようにする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">boolean</span> isOpen;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">boolean</span> flag;</code></pre></div></li>
<li><p>定数は全て<code>static final</code>とし、すべて大文字、区切りは&quot;<code>_</code>&quot;</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String SYSTEM_NAME = <span class="st">&quot;販売管理システム&quot;</span>;</code></pre></div></li>
<li><p>変数名は小文字とし、単語の区切りのみ大文字にする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> String thisIsString;</code></pre></div>
<p>変数名に固有名詞が含まれる場合、先頭をのぞき、単語の区切り以外に大文字を使用してもよい</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> String thisIsIPAddress;</code></pre></div></li>
</ul>
<h2 id="ローカル変数"><span class="header-section-number">3.7</span> ローカル変数</h2>
<ul>
<li><p>スコープが狭い変数名は省略した名前でもよい<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (・・・){
    String s = <span class="st">&quot;・・・・&quot;</span>;
   <span class="co">//変数sを利用した処理 数行</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;・・・・&quot;</span>;
<span class="kw">if</span> (・・・){
   <span class="co">//変数sを利用した処理</span>
}
・・・
<span class="kw">if</span> (・・・){
   <span class="co">//変数sを利用した処理</span>
}</code></pre></div>
<p>変数<code>s</code>の利用範囲が広いので役割が明確になる編素名に変更する。</p></li>
<li><p>for 文のループカウンタは、ネストごとに&quot;<code>i</code>&quot;,&quot;<code>j</code>&quot;,&quot;<code>k</code>&quot;・・・を使う</p></li>
</ul>
<h1 id="コーディング規約"><span class="header-section-number">4</span> コーディング規約</h1>
<h2 id="全般-1"><span class="header-section-number">4.1</span> 全般</h2>
<ul>
<li><p>原則としてオブジェクトの参照にはインターフェースを利用する<br />
オブジェクトを参照する際は、そのオブジェクトの実装クラスを用いて宣言できるが、実装クラスに適切なインターフェースが存在している場合は、必ずインターフェースを用いて宣言すること。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;Entry&gt; list = <span class="kw">new</span> ArrayList&lt;&gt;();
Map&lt;String, String&gt; map = <span class="kw">new</span> HashMap&lt;&gt;();</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">ArrayList&lt;Entry&gt; list = <span class="kw">new</span> ArrayList&lt;&gt;();
HashMap&lt;String, String&gt; map = <span class="kw">new</span> HashMap&lt;&gt;();</code></pre></div></li>
<li><p>推奨されないAPI を使用しない<br />
アノテーション<code>@Deprecated</code>で指定されたメソッドは利用しないこと。</p></li>
<li><p>使われないコードは書かない</p></li>
<li><p>宣言は適切な権限で行うこと（<code>public</code>, <code>protected</code>, <code>private</code>）</p></li>
<li><p><code>final</code> を適切に利用する<br />
継承されないクラス、オーバーライドされないメソッド、値の変わらない変数（つまり定数）等、変化のないもの/変化させたくないものについては<code>final</code> で宣言する。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//継承されないクラス</span>
<span class="kw">public</span> <span class="dt">final</span> <span class="kw">class</span> CalculateUtils {
    <span class="co">//・・・</span>
}

<span class="co">//値の変わらない変数（定数）</span>
<span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String MESSAGE = <span class="st">&quot;・・・&quot;</span>;

<span class="co">//オーバーライドされないメソッド</span>
<span class="kw">public</span> <span class="dt">final</span> <span class="dt">int</span> <span class="fu">sum</span>(<span class="co">/*変化させたくない値*/</span><span class="dt">final</span> <span class="dt">int</span><span class="kw">... </span>values) {
    <span class="dt">int</span> sumValue = <span class="dv">0</span>;
    <span class="kw">for</span> (<span class="co">/*変化させたくない値*/</span><span class="dt">final</span> <span class="dt">int</span> value : values) {
        sumValue += value;
    }
    <span class="kw">return</span> sumValue;
}</code></pre></div></li>
</ul>
<h2 id="フォーマット"><span class="header-section-number">4.2</span> フォーマット</h2>
<ul>
<li>インデントは空白文字4文字分のTabを使用する<br />
</li>
<li>長すぎる行は避ける<br />
</li>
<li><p><code>{</code> の後にステートメントを記述しない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (s == <span class="kw">null</span>) {
    <span class="kw">return</span> <span class="dv">0</span>;
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (s == <span class="kw">null</span>) {<span class="kw">return</span> <span class="dv">0</span>;}</code></pre></div></li>
<li><p>1行に2つ以上のステートメントを記述しない<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">} <span class="kw">catch</span> (Exception e) {
    log.<span class="fu">error</span>(<span class="st">&quot;Error&quot;</span>, e);<span class="kw">return</span> <span class="kw">null</span>;
}</code></pre></div></li>
<li><p>カンマの後には空白文字を<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">process</span>(x, y, z);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="fu">process</span>(x,y,z);</code></pre></div></li>
<li><p>代入演算子（ <code>=</code> , <code>+=</code> , <code>-=</code> , …）の前後には空白文字を挿入する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> a = x;
a += <span class="dv">10</span>;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> a=x;
a+= <span class="dv">10</span>;</code></pre></div></li>
<li><p>for 文内のセミコロンの後には空白文字を挿入する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; array.<span class="fu">length</span>; i++) {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>;i &lt; array.<span class="fu">length</span> ;i++) {
    <span class="co">//・・・</span>
}</code></pre></div></li>
<li><p><code>++</code> や <code>--</code> とオペランドの間には空白文字を入れない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">i++;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">i ++;</code></pre></div></li>
<li>ビット演算子（ <code>|</code> 、 <code>&amp;</code> 、 <code>^</code> 、 <code>&lt;&lt;</code> 、 <code>&gt;&gt;</code> ）の前後には空白文字を挿入する<br />
</li>
<li>論理演算子（ <code>||</code> 、<code>&amp;&amp;</code>）の前後には空白文字を挿入する<br />
</li>
<li>関係演算子（ <code>&lt;</code> 、 <code>&gt;</code> 、 <code>&gt;=</code> 、 <code>&lt;=</code>、<code>==</code>、 <code>!=</code> ）の前後には空白文字を挿入する<br />
</li>
<li>算術演算子（ <code>＋</code> 、 <code>－</code> 、 <code>＊</code> 、 <code>/</code> 、 <code>%</code> ）の前後には空白文字を挿入する<br />
</li>
<li><p>return文ではカッコを使わない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> answer = (a + b + c) * d;
<span class="kw">return</span> answer;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">return</span> ((a + b + c) * d);</code></pre></div></li>
<li><p>ifなどの条件式でbooleanの変数を比較しない</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span>(hasStock)</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span>(hasStock == <span class="kw">true</span>)</code></pre></div></li>
<li><p>不等号の向きは左向き（ <code>&lt;</code> 、 <code>&lt;=</code> ）にする<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (from &lt;= x &amp;&amp; x &lt;= to) {</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (x &gt;= from &amp;&amp; x &lt;= to) {</code></pre></div></li>
</ul>
<h2 id="コメント"><span class="header-section-number">4.3</span> コメント</h2>
<ul>
<li>ファイルの先頭へのCopyrightの表記について<br />
ソースのファイルヘッダにコピーライト標記は法的拘束力がないため、不要とする。<br />
ただし、顧客からの要求があった場合を除く。<br />
</li>
<li><p>Javadoc コメントには、少なくともauthorとversion(クラス)、paramとreturn とexception(メソッド)を記述する</p>
<ul>
<li>今後もバージョンアップのリリースが予定されているソースでは、上記に加えてsince（バージョン）を記述する<br />
</li>
<li><code>@Override</code>のあるメソッドでは、上記に加えて<code>{@Inherit}</code>を記述する</li>
</ul></li>
<li><p>Javadoc　クラスヘッダコメントのフォーマットは以下の通り</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">/**</span>
<span class="co"> * Action（or Bean）クラス　メニュー名称</span>
<span class="co"> *</span>
<span class="co"> * </span><span class="kw">@author </span><span class="co">姓 名</span>
<span class="co"> * </span><span class="kw">@version </span><span class="co">バージョン YYYY/MM/DD 説明</span>
<span class="co"> */</span></code></pre></div></li>
<li><p>コメントは必要なものだけを簡潔に<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">/**</span>
<span class="co"> * 文字列に変換</span>
<span class="co"> */</span>
<span class="fu">@Override</span>
<span class="kw">public</span> String <span class="fu">toString</span>() {

<span class="co">/**</span>
<span class="co"> * コピー</span>
<span class="co"> *</span>
<span class="co"> * </span><span class="kw">@return </span><span class="co">コピーしたインスタンス</span>
<span class="co"> */</span>
<span class="kw">public</span> Entry <span class="fu">copy</span>() {</code></pre></div></li>
<li>不要なコメントは記載しない
<ul>
<li>コードからすぐわかること・冗長なコメント<br />
</li>
<li>名前の説明<br />
コメントではなくわかりやすい名前を付ける。<br />
</li>
<li>別システムで管理している内容<br />
ソースコード管理システム、バグトラッキングシステムで管理している内容はソースコードにコメントで記載する必要はない。
<ul>
<li>コメントアウトされたコード<br />
ソースコード管理システムで管理されている</li>
</ul></li>
</ul></li>
</ul>
<h2 id="インポート"><span class="header-section-number">4.4</span> インポート</h2>
<ul>
<li><p><code>java.lang</code>パッケージはインポートしない</p>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import java.lang.String;</span><span class="co">//必要のない記述</span></code></pre></div></li>
<li><p>原則としてstaticインポートしない<br />
JUnitの作成やフレームワークとしてstaticインポートが推奨されるような場合は利用してもよい</p></li>
<li><p>原則としてオンデマンドのインポート宣言(type-import-on-demand declaration)（アスタリスク<code>*</code>によるインポート） は行わない</p>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">import java.util.*;</span></code></pre></div></li>
</ul>
<h2 id="コンストラクタ"><span class="header-section-number">4.5</span> コンストラクタ</h2>
<ul>
<li><p>public 宣言していないクラスには<code>public</code>権限のコンストラクタを作らない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Entry {
    <span class="co">//・・・</span>
    <span class="fu">Entry</span>(<span class="dt">int</span> id) {
        <span class="co">//・・・</span>
    }</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">class</span> Entry {
    <span class="co">//・・・</span>
    <span class="kw">public</span> <span class="fu">Entry</span>(<span class="dt">int</span> id) {
        <span class="co">//・・・</span>
    }</code></pre></div></li>
<li><p>インスタンスメンバを持たない（staticメンバのみの）クラスは、<code>private</code>権限のコンストラクタを作成する</p></li>
</ul>
<h2 id="メソッド-1"><span class="header-section-number">4.6</span> メソッド</h2>
<ul>
<li>オーバーライドさせたくないメソッドは<code>final</code>を利用する</li>
<li><p>戻り値が配列のメソッドで、戻る配列のサイズが0の場合、メソッドを使用するクライアントの余計なnullチェックのロジックを回避するため、nullではなく長さゼロの配列を戻すようにする。 良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String[] <span class="fu">toArray</span>(String s) {
    <span class="kw">if</span> (s == <span class="kw">null</span> || s.<span class="fu">isEmpty</span>()) {
        <span class="kw">return</span> ArrayUtils.<span class="fu">EMPTY_STRING_ARRAY</span>;
    }
    <span class="kw">return</span> <span class="kw">new</span> String[] { s };
}

<span class="kw">public</span> List&lt;String&gt; <span class="fu">toList</span>(String s) {
    <span class="kw">if</span> (s == <span class="kw">null</span> || s.<span class="fu">isEmpty</span>()) {
        <span class="kw">return</span> Collections.<span class="fu">emptyList</span>();
    }
    <span class="kw">return</span> Arrays.<span class="fu">asList</span>(s);
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> String[] <span class="fu">toArray</span>(String s) {
    <span class="kw">if</span> (s == <span class="kw">null</span> || s.<span class="fu">isEmpty</span>()) {
        <span class="kw">return</span> <span class="kw">null</span>;
    }
    <span class="kw">return</span> <span class="kw">new</span> String[] { s };
}

<span class="kw">public</span> List&lt;String&gt; <span class="fu">toList</span>(String s) {
    <span class="kw">if</span> (s == <span class="kw">null</span> || s.<span class="fu">isEmpty</span>()) {
        <span class="kw">return</span> <span class="kw">null</span>;
    }
    <span class="kw">return</span> Arrays.<span class="fu">asList</span>(s);
}</code></pre></div></li>
<li><p>メソッドは1つの役割にする</p></li>
</ul>
<h2 id="クラスメソッド"><span class="header-section-number">4.7</span> クラスメソッド</h2>
<ul>
<li><p>クラスメソッドを利用するときは、クラス名を使って呼び出す<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> comp = Integer.<span class="fu">compare</span>(x, y);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Integer a = <span class="co">//</span>
<span class="dt">int</span> comp = a.<span class="fu">compare</span>(x, y);</code></pre></div></li>
</ul>
<h2 id="変数全般-1"><span class="header-section-number">4.8</span> 変数全般</h2>
<ul>
<li><p>1つのステートメントには1つの変数宣言<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">/** 科目コード */</span>
<span class="kw">private</span> String code;
<span class="co">/** 科目名 */</span>
<span class="kw">private</span> String name;
<span class="co">/** 科目略名 */</span>
<span class="kw">private</span> String shortName;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> String code, name, shortName;</code></pre></div></li>
<li><p>リテラルは使用しない<br />
リテラルとは、コード中に、表現が定数として直接現れており、記号やリストで表現することができないものを指す（数値、文字列両方含む　通称マジックナンバー）。コードの可読性・保守性の低下を防ぐために、リテラル定数（<code>static final</code> フィールド）を使用すること。<br />
例外：<code>-1</code>,<code>0</code>,<code>1</code> 等をカウント値としてループ処理等で使用するような場合<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">double</span> ONE_MILE_METRE = <span class="fl">1609.344</span>;

<span class="kw">public</span> <span class="dt">double</span> <span class="fu">mileToMetre</span>(<span class="dt">double</span> mi) {
    <span class="kw">return</span> mi * ONE_MILE_METRE;
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">double</span> <span class="fu">mileToMetre</span>(<span class="dt">double</span> mi) {
    <span class="kw">return</span> mi * <span class="fl">1609.344</span>;
}</code></pre></div>
<ul>
<li><p>リテラル定数の名前はその値の意味を正しく表現したものにする</p>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span> ZERO = <span class="dv">0</span>;</code></pre></div></li>
</ul></li>
<li><p>配列宣言は「<code>型名[]</code>」にする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">int</span>[] sampleArray = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">10</span>];</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">int</span> sampleArray[] = <span class="kw">new</span> <span class="dt">int</span>[<span class="dv">10</span>];</code></pre></div></li>
<li>できるだけローカル変数を利用する<br />
ローカル変数で事足りるものをインスタンス変数として利用するなど、必要のないインスタンス変数を定義すると、パフォーマンスや可読性の低下やの大きな要因となる上、マルチスレッドを意識した際に不整合がおきる可能性があるので、インスタンス変数は必要性を充分に考慮してから使用すること。<br />
</li>
<li>定数は<code>final</code>で宣言する<br />
</li>
<li><p>ローカル変数とインスタンス変数を使いわける</p></li>
</ul>
<h2 id="インスタンス変数"><span class="header-section-number">4.9</span> インスタンス変数</h2>
<ul>
<li><p>インスタンス変数は<code>private</code>にする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Employee {
    <span class="kw">private</span> <span class="dt">long</span> id;

    <span class="co">//・・・</span>
    <span class="co">//getter/setter</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Employee {
    <span class="kw">public</span> <span class="dt">long</span> id;

    <span class="co">//・・・</span>
    <span class="co">//getter/setter</span>
}</code></pre></div></li>
</ul>
<h2 id="クラス変数"><span class="header-section-number">4.10</span> クラス変数</h2>
<ul>
<li><p><code>public static final</code> 宣言した配列を利用しない<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> <span class="dt">int</span>[] VALUES = { <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span> };</code></pre></div></li>
<li><p>クラス変数にはクラス名を使用してアクセスすること</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal b = BigDecimal.<span class="fu">ZERO</span>;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal a = <span class="co">//</span>
BigDecimal b = a.<span class="fu">ZERO</span>;</code></pre></div>
<p><br></p>
<p><code>final</code>で配列を宣言していても、不変なのは配列のサイズのみであり、配列の要素は変更可能なので、保持している要素を変えられたくない場合は、<code>Collections</code>クラスの<code>unmodifiableList()</code>メソッド等を使用し、読み取り専用のコレクションを生成すること。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> List&lt;Integer&gt; VALUES = Collections.<span class="fu">unmodifiableList</span>(Arrays.<span class="fu">asList</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>));</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">static</span> <span class="dt">final</span> List&lt;Integer&gt; VALUES = Arrays.<span class="fu">asList</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>);</code></pre></div></li>
</ul>
<h2 id="ローカル変数-1"><span class="header-section-number">4.11</span> ローカル変数</h2>
<ul>
<li><p>ローカル変数は利用する直前で宣言する<br />
行間の程度にもよるが、ある程度まとめて宣言するのはOKとする。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; lines.<span class="fu">length</span>; i++) {
    String line = lines[i];
    <span class="co">//lineの処理</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String line;
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; lines.<span class="fu">length</span>; i++) {
    line = lines[i];
    <span class="co">//lineの処理</span>
}</code></pre></div></li>
<li><p>ローカル変数は安易に再利用しない<br />
一度宣言したローカル変数を、複数の目的で安易に使いまわさないこと。ローカル変数は、役割ごとに新しいものを宣言して初期化することにより、コードの可読性・保守性の向上、及びコンパイラの最適化の促進をはかる。</p></li>
</ul>
<h2 id="引数-1"><span class="header-section-number">4.12</span> 引数</h2>
<ul>
<li><p>メソッド引数への代入は行わない<br />
原則として<code>final</code>で宣言する。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="dt">void</span> <span class="fu">add</span>(<span class="dt">final</span> <span class="dt">int</span> value)
    <span class="co">//・・・</span>
}</code></pre></div></li>
</ul>
<h2 id="継承"><span class="header-section-number">4.13</span> 継承</h2>
<ul>
<li><p>スーパークラスのインスタンス変数をサブクラスでオーバーライドしない<br />
スーパークラスと同じ名前のフィールドをサブクラスで宣言しないこと。 同じ名前のフィールドを宣言すると、スーパークラスのフィールドはサブクラスで宣言されたフィールドによって隠ぺいされてしまうので、他の人の混乱を招くことを防ぐため重複する名前は付けないこと。</p>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Abs {
    <span class="kw">protected</span> String name;
}

<span class="kw">public</span> <span class="kw">class</span> Sub <span class="kw">extends</span> Abs {
    <span class="kw">protected</span> String name;<span class="co">//Abs#nameは隠ぺいされる</span>
}</code></pre></div></li>
<li><p>スーパークラスのメソッドをオーバーライドするときは@Overrideアノテーションを指定する。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Abs {
    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">process</span>() {

    }
}

<span class="kw">public</span> <span class="kw">class</span> Sub <span class="kw">extends</span> Abs {
    <span class="fu">@Override</span>
    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">process</span>() {

    }
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">public</span> <span class="kw">class</span> Abs {
    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">process</span>() {

    }
}

<span class="kw">public</span> <span class="kw">class</span> Sub <span class="kw">extends</span> Abs {
    <span class="co">//@Overrideアノテーションの指定がない</span>
    <span class="kw">protected</span> <span class="dt">void</span> <span class="fu">process</span>() {

    }
}</code></pre></div></li>
<li><p>スーパークラスでprivate 宣言されているメソッドと同じ名前のメソッドをサブクラスで定義しない<br />
スーパークラスにあるprivate メソッドと同じ名前のメソッドをサブクラスで定義しないこと。private メソッドはオーバーライドされず全く別のメソッドとして扱われ、他の人の混乱を招き、バグにつながる恐れがある。</p></li>
</ul>
<h2 id="インナークラス"><span class="header-section-number">4.14</span> インナークラス</h2>
<ul>
<li>原則としてインナークラスは利用しない<br />
一つのjavaファイルに複数のクラスを記載するのはNGとする。また無名クラスを利用するのも原則としてNGとする。<br />
Enumの定数固有メソッド実装(constant-specific method implementation)、Java8のラムダ式は内部的にインナークラスとされるがこれらは許可する。</li>
</ul>
<h2 id="メンバー順序"><span class="header-section-number">4.15</span> メンバー順序</h2>
<ul>
<li><p>以下の順で記述する</p>
<ol type="1">
<li>staticフィールド<br />
</li>
<li>staticイニシャライザー<br />
</li>
<li>staticメソッド<br />
</li>
<li>フィールド<br />
</li>
<li>イニシャライザー<br />
</li>
<li>コンストラクター<br />
</li>
<li>メソッド</li>
</ol></li>
<li><p>同一カテゴリー内では以下の可視性の順で記述する</p>
<ol type="1">
<li>public<br />
</li>
<li>protected<br />
</li>
<li>パッケージprivate<br />
</li>
<li>private</li>
</ol></li>
</ul>
<h2 id="インスタンス"><span class="header-section-number">4.16</span> インスタンス</h2>
<ul>
<li><p>オブジェクト同士は<code>equals()</code>メソッドで比較する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s1 = <span class="st">&quot;text&quot;</span>;
String s2 = <span class="st">&quot;text&quot;</span>;
<span class="kw">if</span> (s1.<span class="fu">equals</span>(s2)) {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s1 = <span class="st">&quot;text&quot;</span>;
String s2 = <span class="st">&quot;text&quot;</span>;
<span class="kw">if</span> (s1 == s2) {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>ただしEnumの場合は<code>==</code>演算子を利用して比較する</p>
<p><code>equals()</code>メソッドで比較する際、左辺のオブジェクトがnullにならないように制御すること。</p></li>
<li><p>Class 名を利用した比較をおこなわない</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(o <span class="kw">instanceof</span> Foo)</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(<span class="st">&quot;hoge.Foo&quot;</span>.<span class="fu">equals</span>(o.<span class="fu">getClass</span>().<span class="fu">getName</span>()))</code></pre></div></li>
</ul>
<h2 id="制御構造"><span class="header-section-number">4.17</span> 制御構造</h2>
<ul>
<li><p>制御文（ <code>if</code> , <code>else</code> , <code>while</code> , <code>for</code> , <code>do while</code> ）の <code>{ }</code> は省略しない</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (s == <span class="kw">null</span>) {
    <span class="kw">return</span>;
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span> (s == <span class="kw">null</span>)
    <span class="kw">return</span>;</code></pre></div></li>
<li><p>ステートメントが無い <code>{}</code> ブロックを利用しない<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">//{}内の記述が無い</span>
<span class="kw">if</span> (s == <span class="kw">null</span>) {
}</code></pre></div></li>
<li><p><code>if</code> / <code>while</code> の条件式で <code>=</code> は利用しない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">boolean</span> a =<span class="co">//</span>
<span class="kw">if</span> (!a) {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">boolean</span> a =<span class="co">//</span>
<span class="kw">if</span> (a = <span class="kw">false</span>) {<span class="co">//コーディングミス</span>
    <span class="co">//・・・</span>
}


<span class="dt">boolean</span> a =<span class="co">//</span>
<span class="dt">boolean</span> b =<span class="co">//</span>
<span class="kw">if</span> (a = b) {<span class="co">//おそらくコーディングミス</span>
    <span class="co">//・・・</span>
}</code></pre></div></li>
<li><code>for</code> と <code>while</code> の使い分けを意識する<br />
</li>
<li><p>for 文を利用した繰り返し処理中でループ変数の値を変更しない<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String[] array = { <span class="co">/*・・・*/</span> };
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; array.<span class="fu">length</span>; i++) {
    <span class="co">//・・・</span>
    i += <span class="dv">2</span>;<span class="co">//NG</span>
}

<span class="kw">for</span> (String s : array) {
    <span class="co">//・・・</span>
    s = <span class="st">&quot;string&quot;</span>;<span class="co">//NG</span>
}</code></pre></div></li>
<li>for 文のカウンタは特別な事情がない限り、0から始める<br />
</li>
<li><p>配列やリストなどの全要素に対するループ処理は拡張for文を使用する。<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (<span class="dt">int</span> value : array) {
    <span class="co">//・・・</span>
}

<span class="kw">for</span> (String value : list) {
    <span class="co">//・・・</span>
}</code></pre></div></li>
<li><p>配列をコピーするときは<code>Arrays.copyOf()</code>メソッドを利用する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] newArray = Arrays.<span class="fu">copyOf</span>(array, array.<span class="fu">length</span>);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span>[] newArray = <span class="kw">new</span> <span class="dt">int</span>[array.<span class="fu">length</span>];
System.<span class="fu">arraycopy</span>(array, <span class="dv">0</span>, newArray, <span class="dv">0</span>, array.<span class="fu">length</span>);</code></pre></div></li>
<li>繰り返し処理中のオブジェクトの生成は最小限にする<br />
</li>
<li><p>if 文とelse 文の繰り返しやswitch 文の利用はなるべく避け、オブジェクト指向の手法を利用する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">CodingKind codingKind = <span class="fu">toCodingKind</span>(kind);
d = codingKind.<span class="fu">encode</span>(s);

<span class="co">//---</span>

CodingKind codingKind = <span class="fu">toCodingKind</span>(kind);
s = codingKind.<span class="fu">decode</span>(d);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">switch</span> (kind) {
<span class="kw">case</span> <span class="dv">1</span>:
    d = <span class="fu">encode1</span>(s);
    <span class="kw">break</span>;
<span class="kw">case</span> <span class="dv">2</span>:
    d = <span class="fu">encode2</span>(s);
    <span class="kw">break</span>;
<span class="kw">default</span>:
    <span class="kw">break</span>;
}

<span class="co">//---</span>

<span class="kw">switch</span> (kind) {
<span class="kw">case</span> <span class="dv">1</span>:
    s = <span class="fu">decode1</span>(d);
    <span class="kw">break</span>;
<span class="kw">case</span> <span class="dv">2</span>:
    s = <span class="fu">decode2</span>(d);
    <span class="kw">break</span>;
<span class="kw">default</span>:
    <span class="kw">break</span>;
}</code></pre></div></li>
<li><p>繰り返し処理の内部で <code>try</code> ブロックを利用しない<br />
特に理由がない場合は繰り返し処理の外に<code>try</code>ブロックを記載する。<br />
ただし、繰り返し処理内部で例外をキャッチし処理を行いたい場合は繰り返し処理の内部で<code>try</code>ブロックを利用してもよい。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (String s : array) {
    <span class="dt">int</span> num;
    <span class="kw">try</span> {
        num = Integer.<span class="fu">parseInt</span>(s);
    } <span class="kw">catch</span> (NumberFormatException e) {
        num = -<span class="dv">1</span>;
    }
    <span class="co">//・・・</span>
}</code></pre></div></li>
</ul>
<h2 id="文字列操作"><span class="header-section-number">4.18</span> 文字列操作</h2>
<ul>
<li><p>文字列同士が同じ値かを比較するときは、<code>equals()</code>メソッドを利用する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s1 = <span class="st">&quot;text&quot;</span>;
String s2 = <span class="st">&quot;text&quot;</span>;
<span class="kw">if</span> (s1.<span class="fu">equals</span>(s2)) {
    <span class="co">//・・・</span>
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s1 = <span class="st">&quot;text&quot;</span>;
String s2 = <span class="st">&quot;text&quot;</span>;
<span class="kw">if</span> (s1 == s2) {
    <span class="co">//・・・</span>
}</code></pre></div></li>
<li><p>文字列リテラルは<code>new</code> しない<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;&quot;</span>;</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="kw">new</span> String();</code></pre></div></li>
<li><p>更新される文字列には<code>StringBuilder</code> クラスを利用する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">StringBuilder builder = <span class="kw">new</span> StringBuilder();
<span class="kw">for</span> (String s : array) {
    builder.<span class="fu">append</span>(s);
}
System.<span class="fu">out</span>.<span class="fu">println</span>(builder.<span class="fu">toString</span>());</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String string = <span class="st">&quot;&quot;</span>;
<span class="kw">for</span> (String s : array) {
    string += s;
}
System.<span class="fu">out</span>.<span class="fu">println</span>(string);</code></pre></div>
<p><br> スレッドセーフ性が保証されていない箇所では<code>StringBuffer</code>クラスを利用する</p>
<p><a href="#文字列連結">※パフォーマンスについても記載しているので参考にしてください</a></p></li>
<li>更新されない文字列には<code>String</code> クラスを利用する<br />
</li>
<li><p>文字列リテラルと定数を比較するときは、文字列リテラルの<code>equals()</code>メソッドを利用する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String PROTOCOL_HTTP = <span class="st">&quot;http&quot;</span>;

<span class="kw">if</span> (PROTOCOL_HTTP.<span class="fu">equals</span>(url.<span class="fu">getProtocol</span>())) {

}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String PROTOCOL_HTTP = <span class="st">&quot;http&quot;</span>;

<span class="kw">if</span> (url.<span class="fu">getProtocol</span>().<span class="fu">equals</span>(PROTOCOL_HTTP)) {

}</code></pre></div></li>
<li><p>プリミティブ型と<code>String</code> オブジェクトの変換には、変換用のメソッドを利用する<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> i = <span class="dv">1000</span>;
String s = String.<span class="fu">valueOf</span>(i);<span class="co">// &quot;1000&quot;</span>
s = NumberFormat.<span class="fu">getNumberInstance</span>()<span class="fu">.format</span>(i);<span class="co">// 3桁区切り &quot;1,000&quot;</span>

<span class="dt">boolean</span> b = <span class="kw">true</span>;
s = String.<span class="fu">valueOf</span>(b);<span class="co">// true/false</span>
s = BooleanUtils.<span class="fu">toStringOnOff</span>(b);<span class="co">// on/off</span></code></pre></div></li>
<li>文字列の中に、ある文字が含まれているか調べるには、<code>contains()</code>メソッドを利用する<br />
</li>
<li><p>システム依存記号（ <code>¥n</code> 、 <code>¥r</code> など）は使用しない。<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String text = Arrays.<span class="fu">stream</span>(array)
    .<span class="fu">collect</span>(Collectors.<span class="fu">joining</span>(<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>));</code></pre></div></li>
</ul>
<h2 id="数値"><span class="header-section-number">4.19</span> 数値</h2>
<ul>
<li>誤差の無い計算をするときは、<code>BigDecimal</code> クラスを使う<br />
浮動小数点演算は科学技術計算に利用するもので、誤差が発生する。これに対して、クラス「<code>BigDecimal</code>」は、文字列で数値の計算を行うので、金額などの正確な計算に適している。<code>BigDecimal</code> ではインスタンス生成時に指定された桁数での精度が保証される。<br />
</li>
<li><p>数値の比較は精度に気をつける<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal a = <span class="kw">new</span> BigDecimal(<span class="st">&quot;1&quot;</span>);
BigDecimal b = <span class="kw">new</span> BigDecimal(<span class="st">&quot;1.0&quot;</span>);
<span class="kw">if</span> (a.<span class="fu">compareTo</span>(b) == <span class="dv">0</span>) {
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;一致&quot;</span>);
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal a = <span class="kw">new</span> BigDecimal(<span class="st">&quot;1&quot;</span>);
BigDecimal b = <span class="kw">new</span> BigDecimal(<span class="st">&quot;1.0&quot;</span>);

<span class="kw">if</span> (a.<span class="fu">equals</span>(b)) {
    System.<span class="fu">out</span>.<span class="fu">println</span>(<span class="st">&quot;精度が違うためこの分岐には入らない&quot;</span>);
}</code></pre></div></li>
<li>低精度なプリミティブ型にキャストしない<br />
</li>
<li><p><code>BigDecimal</code>を<code>String</code>変換する際は<code>toString()</code>ではなく<code>toPlainString()</code>を利用すること<br />
<code>toString()</code>を利用した場合、指数表記になることがあります。</p></li>
</ul>
<h2 id="日付"><span class="header-section-number">4.20</span> 日付</h2>
<ul>
<li><p>日付の文字列のフォーマットには、<code>SimpleDateFormat</code>を使う<br />
良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Date date = <span class="kw">new</span> Date();
SimpleDateFormat dateFormat = <span class="kw">new</span> SimpleDateFormat(<span class="st">&quot;yyyy/MM/dd&quot;</span>);
String s = dateFormat<span class="fu">.format</span>(date);</code></pre></div></li>
</ul>
<h2 id="三項演算子"><span class="header-section-number">4.21</span> 三項演算子</h2>
<ul>
<li>入れ子の三項演算子の利用は禁止<br />
可読性が悪くなるので三項演算子を入れ子で行うのは禁止。</li>
</ul>
<h2 id="コレクション"><span class="header-section-number">4.22</span> コレクション</h2>
<ul>
<li>Java2以降のコレクションクラスを利用する<br />
<code>Vector</code> クラス、<code>Hashtable</code> クラス、<code>Enumeration</code> 等は、特にこれらを利用する理由がなければ、インターフェースを統一する目的で、これらの代わりに<code>List</code>(<code>ArrayList</code> クラス)、<code>Map</code>(<code>HashMap</code> クラス)、<code>Iterator</code> を使用すること。<code>List</code> などのインターフェースを利用することでJDK1.2 で整理されたわかりやすいメソッドを利用でき、また、インターフェースの特性から呼び出し元を変更せずに実装クラスを変更することができる。<br />
</li>
<li><p>特定の型のオブジェクトだけを受け入れるコレクションクラスを利用する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;Map&lt;String, String&gt;&gt; list = <span class="kw">new</span> ArrayList&lt;&gt;();</code></pre></div></li>
<li><code>List</code>のソートは<code>List.sort()</code>を利用する<br />
<code>List</code>クラスの要素をソートする際はJava8で追加された<code>List.sort()</code>を利用すること。<br />
Java 7以前で利用されていた<code>Collections.sort()</code>は利用しないこと。<br />
</li>
<li><code>Collection.forEach()</code>は利用しない<br />
Java8で追加されたメソッド。<br />
原則利用しない。拡張for文を利用する。<br />
具体的には下記のメソッドを利用しないこと。
<ul>
<li><code>Collection#forEach</code><br />
</li>
<li><code>Set#forEach</code><br />
</li>
<li><code>List#forEach</code></li>
</ul></li>
</ul>
<h2 id="ラムダ式メソッド参照コンストラクタ参照"><span class="header-section-number">4.23</span> ラムダ式・メソッド参照・コンストラクタ参照</h2>
<ul>
<li>ラムダ式が利用できる箇所はラムダ式を利用してよい<br />
<a href="#ラムダ式メソッド参照コンストラクタ参照-1">※パフォーマンスについても記載しているので参考にしてください</a><br />
</li>
<li><p>ただし、メソッド参照・コンストラクタ参照が利用できる場合はメソッド参照・コンストラクタ参照を利用する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String::compareToIgnoreCase</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(s1, s2) -&gt; s1.<span class="fu">compareToIgnoreCase</span>(s2)</code></pre></div>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal::add</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(b1, b2) -&gt; b1.<span class="fu">add</span>(b2)</code></pre></div></li>
<li><p>ラムダ式記述の際、型宣言は省略記法で記述する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(s1, s2) -&gt; s1 + <span class="st">&quot;=&quot;</span> + s2  </code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(String s1, String s2) -&gt; s1 + <span class="st">&quot;=&quot;</span> + s2  </code></pre></div></li>
<li><p>原則ラムダ式内の行数は1行とする<br />
複数行で利用したい場合は、<code>private</code>メソッドを作成しメソッド参照を利用する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">this</span>::getMax

<span class="kw">private</span> <span class="dt">int</span> <span class="fu">getMax</span>(<span class="dt">int</span> i1, <span class="dt">int</span> i2) {
    <span class="kw">if</span> (i1 &gt; i2) {
        <span class="kw">return</span> i1;
    } <span class="kw">else</span> {
        <span class="kw">return</span> i2;
    }
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(i1, i2) -&gt; {
    <span class="kw">if</span> (i1 &gt; i2) {
        <span class="kw">return</span> i1;
    } <span class="kw">else</span> {
        <span class="kw">return</span> i2;
    }
}</code></pre></div></li>
<li><p>原則ラムダ式は1行記述に限定するので、中カッコ、<code>return</code>は必ず省略する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(s1, s2) -&gt; s1 + <span class="st">&quot;=&quot;</span> + s2  </code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">(s1, s2) -&gt; {
    <span class="kw">return</span> s1 + <span class="st">&quot;=&quot;</span> + s2;
}</code></pre></div></li>
</ul>
<h2 id="実質的finaleffectively-final"><span class="header-section-number">4.24</span> 実質的final（effectively final）</h2>
<ul>
<li>実質的finalを利用する<br />
変数宣言に<code>final</code>を記載しなくてよい。</li>
</ul>
<h2 id="stream-api"><span class="header-section-number">4.25</span> Stream API</h2>
<ul>
<li>利用してよい<br />
<a href="#stream-api-1">※パフォーマンスについても記載しているので参考にしてください</a><br />
</li>
<li><p>並列ストリームは利用しないこと<br />
悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Stream&lt;?&gt; s = list. <span class="fu">parallelStream</span>();
Stream&lt;?&gt; s = list.<span class="fu">stream</span>().<span class="fu">parallel</span>();</code></pre></div></li>
<li><p>StreamAPI記述の際の改行位置は、各中間処理・末端処理前のピリオドの前で改行する</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;Character&gt; alphabetLower = list.<span class="fu">stream</span>()
    .<span class="fu">filter</span>(Character::isAlphabetic)
    .<span class="fu">map</span>(Character::toLowerCase)
    .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;Character&gt; alphabetLower = list.<span class="fu">stream</span>().<span class="fu">filter</span>(Character::isAlphabetic)
    .<span class="fu">map</span>(Character::toLowerCase).<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());

List&lt;Character&gt; alphabetLower = list
    .<span class="fu">stream</span>()
    .<span class="fu">filter</span>(Character::isAlphabetic)
    .<span class="fu">map</span>(Character::toLowerCase)
    .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</code></pre></div></li>
<li>Indentは統合開発環境の提供するフォーマッタに合わせる<br />
</li>
<li>中間処理の数は3つ（3行）程度までを推奨する<br />
中間処理の記述が多くなると可読性も悪くなり、デバッグも難しくなるため、3行程度を目安にロジックを検討すること。<br />
</li>
<li><p>コメントは、原則として処理中には記載しない<br />
難解になってしまった場合のみ処理中の記載を認める</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="co">// クラスFooのフィールドStrの値で昇順にソートし、フィールドStrの要素を取得して処理する。</span>
hogeList.<span class="fu">stream</span>()
    .<span class="fu">sorted</span>(Comparator.<span class="fu">comparing</span>(Foo::getStr))
    .<span class="fu">map</span>(Foo::getStr)
    .<span class="fu">forEach</span>(<span class="kw">this</span>::proc);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">hogeList.<span class="fu">stream</span>()
    .<span class="fu">sorted</span>(Comparator.<span class="fu">comparing</span>(Foo::getStr)) <span class="co">//クラスFooのフィールドStrの値で昇順にソート</span>
    .<span class="fu">map</span> (Foo::getStr) <span class="co">//フィールドStrの要素を取得</span>
    .<span class="fu">forEach</span>(<span class="kw">this</span>::proc); <span class="co">//処理</span>


hogeList.<span class="fu">stream</span>()
    <span class="co">//クラスFooのフィールドStrの値で昇順にソート</span>
    .<span class="fu">sorted</span>(Comparator.<span class="fu">comparing</span>(Foo::getStr))
    <span class="co">//フィールドStrの要素を取得</span>
    .<span class="fu">map</span> (Foo::getStr)
    <span class="co">//処理</span>
    .<span class="fu">forEach</span>(<span class="kw">this</span>::proc);</code></pre></div></li>
<li><p>Streamは極力変数代入しないこと<br />
Streamは中間処理、末端処理を行うと使用済みとなり、以降同じインスタンスは利用できない。<br />
変数代入はほとんどの場合意味をなさず、むしろミスの元となるため極力変数代入はしないこと。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;String&gt; list1 = Arrays.<span class="fu">asList</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>).<span class="fu">stream</span>()
        .<span class="fu">map</span>(String::toLowerCase)
        .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());

List&lt;String&gt; list2 = Arrays.<span class="fu">asList</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>).<span class="fu">stream</span>()
        .<span class="fu">map</span>(s -&gt; s + s)
        .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Stream&lt;String&gt; stream = Arrays.<span class="fu">asList</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>, <span class="st">&quot;C&quot;</span>).<span class="fu">stream</span>();
Stream&lt;String&gt; stream1 = stream.<span class="fu">map</span>(String::toLowerCase);
List&lt;String&gt; list1 = stream1.<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());

Stream&lt;String&gt; stream2 = stream.<span class="fu">map</span>(s -&gt; s + s);<span class="co">//コーディングミス streamは使用済のためエラーになる</span>
List&lt;String&gt; list2 = stream2.<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());</code></pre></div></li>
</ul>
<h2 id="optional"><span class="header-section-number">4.26</span> Optional</h2>
<ul>
<li><p>Optionalは同メソッド内で値を取り出す場合は極力変数代入しないこと<br />
Optionalとその値の変数は同じものを示す名前となり、同じ意味の変数名が複数現れることで可読性が下がるため、Optionalの変数代入は行わないこととする。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Employee employee = <span class="fu">findEmployee</span>(employeeId)
        .<span class="fu">orElseThrow</span>(IllegalArgumentException::<span class="kw">new</span>);</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Optional&lt;Employee&gt; employeeOpt = <span class="fu">findEmployee</span>(employeeId);
Employee employee = employeeOpt.<span class="fu">orElseThrow</span>(IllegalArgumentException::<span class="kw">new</span>);</code></pre></div>
<p><br> 直接、値を取り出すことなくOptionalでのみ扱う場合はOptionalを変数代入してもよい。</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Optional&lt;Employee&gt; employee = <span class="fu">findEmployee</span>(employeeId);

Dept dept = employee.<span class="fu">map</span>(Employee::getDivision)
        .<span class="fu">map</span>(Division::getDept)
        .<span class="fu">orElse</span>(<span class="kw">null</span>);

Role role = employee.<span class="fu">map</span>(Employee::getRole)
        .<span class="fu">orElse</span>(<span class="kw">null</span>);

<span class="co">//-----</span>

Optional&lt;Employee&gt; employee = <span class="fu">findEmployee</span>(employeeId);
<span class="co">//・・・処理</span>
<span class="kw">return</span> employee;</code></pre></div></li>
</ul>
<h2 id="ストリームinputstream-outputstream"><span class="header-section-number">4.27</span> ストリーム（InputStream OutputStream）</h2>
<ul>
<li><p>ストリームを扱うAPI を利用するときは、try-with-resources文で後処理をする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span>(InputStream inputStream = <span class="kw">new</span> FileInputStream(<span class="st">&quot;HOGE.txt&quot;</span>)){
    <span class="co">//inputStreamに対する処理を記載</span>
}</code></pre></div></li>
<li><p><code>ObjectOutputStream</code> では<code>reset()</code>を利用する</p></li>
</ul>
<h2 id="リソースの解放"><span class="header-section-number">4.28</span> リソースの解放</h2>
<ul>
<li><p>リソース解放を必要とするクラスを利用するときは、try-with-resources文で後処理をする</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span>(InputStream inputStream = <span class="kw">new</span> FileInputStream(<span class="st">&quot;HOGE.txt&quot;</span>)){
    <span class="co">//inputStreamに対する処理を記載</span>
}</code></pre></div></li>
<li><p>リソース解放を必要とするクラスを作成する場合は<code>AutoCloseable</code>を<code>implements</code>する<br />
<code>AutoCloseable</code>を<code>implements</code>することでtry-with-resources文が利用できるようになります。</p></li>
</ul>
<h2 id="例外"><span class="header-section-number">4.29</span> 例外</h2>
<ul>
<li><p>catch 文で受け取る例外は、詳細な例外クラスで受け取る</p>
<p>良い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span> (InputStream inputStream = <span class="kw">new</span> FileInputStream(<span class="st">&quot;HOGE.txt&quot;</span>)) {
    <span class="co">//・・・</span>
} <span class="kw">catch</span> (IOException e) {
    log.<span class="fu">error</span>(<span class="st">&quot;Error&quot;</span>, e);
    <span class="kw">throw</span> e;
}</code></pre></div>
<p>悪い例：</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">try</span> (InputStream inputStream = <span class="kw">new</span> FileInputStream(<span class="st">&quot;HOGE.txt&quot;</span>)) {
    <span class="co">//・・・</span>
} <span class="kw">catch</span> (Exception e) {<span class="co">//範囲が広すぎる例外クラスの利用はNG</span>
    log.<span class="fu">error</span>(<span class="st">&quot;Error&quot;</span>, e);
    <span class="kw">throw</span> e;
}</code></pre></div></li>
<li><code>Exception</code> クラスのオブジェクトを生成してスローしない<br />
</li>
<li><code>catch</code> ブロックでは基本、例外処理をする。ただし処理を書いてはいけない部分もあるので、その部分については、&quot;<code>// ignore</code>&quot; というコメントを記述すること。<br />
</li>
<li><p>例外クラスは無駄に定義しない</p></li>
</ul>
<h2 id="ガベージコレクション"><span class="header-section-number">4.30</span> ガベージコレクション</h2>
<ul>
<li>原則<code>finalize()</code>のオーバーライド実装は禁止<br />
</li>
<li>もし<code>finalize()</code>をオーバーライドした場合は<code>super.finalize()</code> を呼び出す<br />
</li>
<li>アプリケーションから<code>finalize()</code>を呼び出さない</li>
</ul>
<h1 id="コメント規約"><span class="header-section-number">5</span> コメント規約</h1>
<h2 id="よいコメントの鉄則"><span class="header-section-number">5.1</span> よいコメントの鉄則</h2>
<ul>
<li>コードを明確化するコメントを書く<br />
コードにコメントを書く理由は、自分自身、一緒に仕事をしている人、後に関わる開発者にとってコードをより理解しやすいものにするためである。<br />
</li>
<li>コメント化する価値がないプログラムならば、実行するに値しない<br />
有用な格言。コメントは必須。<br />
</li>
<li>過剰な装飾は使わない （例：見出し状のコメント）<br />
1960年代から1970年代の典型的なCOBOLプログラマにはアスタリスク( <code>*</code> )でコメントを囲った箱を書く習慣があった。彼らの芸術的な主張を表わしているのかもしれないが、率直に言えばそれは製品に加わるちょっとした価値に比べれば大きな時間の無駄である。かわいいコードではなくきれいなコードを書くはずである。さらに、コードを表示するディスプレイや印刷するプリントに使われるフォントはプロポーショナルだったりそうでなかったりして、箱をきれいに整列させることは難しい。<br />
</li>
<li>コメントはシンプルに<br />
かつて見たもっとも最良のコメントは、シンプルな要点をまとめた注釈であった。なにも本を書く必要はなく、他の人がコードを理解するに十分な情報を提供するだけでよいのである。<br />
</li>
<li>コードを書く前に先にコメントを記述する<br />
コードをコメント化する最良の方法は、コードを書く前にコメントを書くことである。それが、コードを書く前にコードがどのように動作するかについて考えるよい機会となり、コメントの存在を保障することにもつながる。少なくともコードを書いた時にコメントすべきである。コメントによってコードが理解しやすくなることで、コードの開発中にアドバンテージを得ることができる。コードにコメントを書く時間を費やせば、それによって得られるものがある。<br />
</li>
<li><p>コメントには、なぜそうなのかを書く。コードを読めば分かることを書かない<br />
基本的に、コードの一部分を見ればそれが何かを理解することはできる。例えば、以下のコードを見て、$1000以上の注文については5%ディスカウントされることは理解できる。なぜそうなのか？大きな注文ではディスカウントがつきものだというビジネスルールがあるのだろうか？大きな注文に時間限定サービスがあるのか、それともずっとサービスがあるのか？これを書いたプログラマの気前がよかったのか？<br />
どこかソースコード中か別な文書にコメントされていない限り、それがなぜなのかを知ることはできない。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">if</span>(grandTotal &gt;= <span class="fl">1000.00</span>) {
    grandTotal = grandTotal * <span class="fl">0.95</span>;
}</code></pre></div>
なお、メソッドコメントには、適切なjavadocコメント（タグ）のほかに、以下の内容も可能な限り明記すること。
<ul>
<li>副作用のある処理の場合は、その内容　（→ メソッドの引数オブジェクトがメソッド内で変更されるケースなど）<br />
</li>
<li>既知のバグ　（→ 判明しているが修正しないことにした場合など）<br />
</li>
<li>影響のある事前条件、事後条件　（→ メソッドが正しく動作するための前提について）<br />
</li>
<li>並行性　（→　マルチスレッドでアクセスされた場合の動作について）<br />
</li>
<li>該当メソッドの使用例やサンプルコード</li>
</ul></li>
<li><p>TODOコメント<br />
設計者確認待ち、共通処理の作成待ちなどの理由により、実装時にTODOがある場合、下記のようにコメントを記述する。<br />
（EclipseのTODOコメント形式を採用）<br />
例）</p>
<pre><code>//TODO：ワークフローの仕様決定待ち　関連チケット#12345</code></pre></li>
</ul>
<h2 id="javaコメント3種類の使い分け"><span class="header-section-number">5.2</span> Javaコメント（3種類）の使い分け</h2>
<p>Javaでは3種類のコメントが使える。javadocコメントは<code>/**</code>で開始され、<code>*/</code>で終わる。C風コメントは<code>/*</code>で開始され<code>*/</code>で終わる。単一行コメントは<code>//</code>で開始され、そのソースコード行が終わるまで続く。以下の表ではコメントの使い方とその例を示す。（コメントのスタイルに関しては、前述の「標準規約に準拠したコーディング例」を参照）</p>
<table>
<colgroup>
<col style="width: 20%"></col>
<col style="width: 59%"></col>
<col style="width: 20%"></col>
</colgroup>
<thead>
<tr class="header">
<th>コメント種類</th>
<th>使用方法</th>
<th>例</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>javadocコメント<br><code>/** comment */</code></td>
<td>interface、class、メソッド、フィールドの直前に書く。コメントはjavadocによって処理され、外部ドキュメント(HTML)として生成される。（この形式以外のコメントはドキュメントとして出力されないことに注意）</td>
<td><code class="comment-code">/**<br> * 顧客（Customer）-<br> * 顧客はわれわれがサービスまたは製品を売った人物<br> * もしくは組織のいずれかである。<br> * <span class="citation" data-cites="author">@author</span> 開発太郎<br> */</code></td>
</tr>
<tr class="even">
<td>C 風コメント<br><code>/* comment */</code></td>
<td>特定のコードを無効化したいが、後で使用するかもしれないので残しておくためにコメント化する時や、デバッグ時に一時的に無効化するときに使用する。</td>
<td><code class="comment-code">/* <br> このコードはJ.T.Kirkによって1997.12.9に前述のコードと置き換えたためコメント化した。2年間不要であるならば削除せよ。<br> ... (ソースコード) <br> */</code></td>
</tr>
<tr class="odd">
<td>単一行コメント<br><code>// comment</code></td>
<td>メソッド内にて、ビジネスロジック、コードの概要、一時変数の定義内容などを記述する。</td>
<td><code class="comment-code">// 1995年2月に開始されたX氏の寛大なキャンペーンで<br>// 定められた通り1000$を超える請求には、全て5%割引を<br>// 適用する。</code></td>
</tr>
</tbody>
</table>
<p>※ ロジック中に、頻繁にC風コメントでコメントを書くとまとめてコメントアウトする場合に不便なため、基本的にロジック中では単一行コメントを利用すること。</p>
<h1 id="パフォーマンス"><span class="header-section-number">6</span> パフォーマンス</h1>
<p>パフォーマンスを考慮したJavaのコーディングについて以下に示す。</p>
<p>※ パフォーマンスはjreのバージョンやスペックによって変化します。本内容はjre1.8.0_74での検証結果を元にした内容です。</p>
<p>※ 性能計測結果についての記載がありますが、あくまでも参考値です。性能を保証するものではありません。</p>
<h2 id="stream-api-1"><span class="header-section-number">6.1</span> Stream API</h2>
<p>Java8で追加されたStream APIでの記述は、可読性も高く、簡潔に書けますが、パフォーマンス・性能面で注意が必要な場合があります。</p>
<p>Listの処理を行う際、拡張for文で処理する場合はIteratorインスタンスが1つだけ生成されますが、Stream APIで処理する場合、最初のStreamインスタンスに加え、各中間処理ごとにもStreamインスタンスが生成され、その分の性能劣化が懸念されます。<br />
以下に処理例と計測結果を記載します。</p>
<ul>
<li><p>拡張for文</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;String&gt; list = <span class="co">//数値文字列のList</span>
List&lt;String&gt; resultList = <span class="kw">new</span> ArrayList&lt;&gt;();
<span class="kw">for</span> (String string : list) {
    <span class="kw">if</span> (string.<span class="fu">endsWith</span>(<span class="st">&quot;0&quot;</span>)) {
        resultList.<span class="fu">add</span>(string);
    }
}
<span class="kw">return</span> resultList;</code></pre></div></li>
<li><p>Stream API</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">List&lt;String&gt; list = <span class="co">//数値文字列のList</span>
List&lt;String&gt; resultList = list.<span class="fu">stream</span>()
    .<span class="fu">filter</span>(s -&gt; s.<span class="fu">endsWith</span>(<span class="st">&quot;0&quot;</span>))
    .<span class="fu">collect</span>(Collectors.<span class="fu">toList</span>());
<span class="kw">return</span> resultList;</code></pre></div></li>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理するListの件数</th>
<th style="text-align: right;">拡張for文 (ms)</th>
<th style="text-align: right;">StreamAPI (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">100万件</td>
<td style="text-align: right;">7</td>
<td style="text-align: right;">9</td>
</tr>
<tr class="even">
<td style="text-align: right;">1,000万件</td>
<td style="text-align: right;">88</td>
<td style="text-align: right;">114</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1億件</td>
<td style="text-align: right;">949</td>
<td style="text-align: right;">1,026</td>
</tr>
<tr class="even">
<td style="text-align: right;">2億件</td>
<td style="text-align: right;">1,822</td>
<td style="text-align: right;">2,081</td>
</tr>
</tbody>
</table></li>
</ul>
<p>小中規模の処理量であれば考慮するほどの性能差はありませんが、大量の処理が見込まれる場合は考慮が必要です。<br />
また、Stream APIは並列処理（スレッド処理）の機能をサポートしていますので、利用できる場合は並列処理も含めての検証が必要です。</p>
<h2 id="ラムダ式メソッド参照コンストラクタ参照-1"><span class="header-section-number">6.2</span> ラムダ式・メソッド参照・コンストラクタ参照</h2>
<p>Java8で追加されたラムダ式・メソッド参照・コンストラクタ参照は、匿名クラスを利用するよりも効率的です。<br />
積極的な利用を推奨します。</p>
<p>以下にComparatorを生成した場合の計測結果を記載します。</p>
<ul>
<li><p>匿名クラス</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Comparator&lt;String&gt; c = <span class="kw">new</span> Comparator&lt;String&gt;() {
    <span class="fu">@Override</span>
    <span class="kw">public</span> <span class="dt">int</span> <span class="fu">compare</span>(String o1, String o2) {
        <span class="kw">return</span> o1.<span class="fu">compareToIgnoreCase</span>(o2);
    }
};</code></pre></div></li>
<li><p>ラムダ式</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Comparator&lt;String&gt; c = (o1, o2) -&gt; o1.<span class="fu">compareToIgnoreCase</span>(o2);</code></pre></div></li>
<li><p>メソッド参照</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Comparator&lt;String&gt; c = String::compareToIgnoreCase;</code></pre></div></li>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理件数</th>
<th style="text-align: right;">匿名クラス (ms)</th>
<th style="text-align: right;">ラムダ式 (ms)</th>
<th style="text-align: right;">メソッド参照 (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10億回</td>
<td style="text-align: right;">380</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="even">
<td style="text-align: right;">100億回</td>
<td style="text-align: right;">6,374</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="odd">
<td style="text-align: right;">1京回</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">14</td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table></li>
</ul>
<p>ラムダ式は外部の変数を利用する場合、匿名クラスとほぼ同じ動作をします。</p>
<ul>
<li><p>匿名クラス</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">new</span> Comparator&lt;String&gt;() {
        <span class="fu">@Override</span>
        <span class="kw">public</span> <span class="dt">int</span> <span class="fu">compare</span>(String o1, String o2) {
            <span class="kw">return</span> arg.<span class="fu">equals</span>(<span class="st">&quot;DESC&quot;</span>) ? o2.<span class="fu">compareToIgnoreCase</span>(o1)
                                            : o1.<span class="fu">compareToIgnoreCase</span>(o2);
        }
    }</code></pre></div></li>
<li><p>ラムダ式</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">Comparator&lt;String&gt; c = (o1, o2) -&gt; arg.<span class="fu">equals</span>(<span class="st">&quot;DESC&quot;</span>) ? o2.<span class="fu">compareToIgnoreCase</span>(o1)
                                    : o1.<span class="fu">compareToIgnoreCase</span>(o2);</code></pre></div></li>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理件数</th>
<th style="text-align: right;">匿名クラス (ms)</th>
<th style="text-align: right;">ラムダ式 (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">10億回（パラメータあり）</td>
<td style="text-align: right;">571</td>
<td style="text-align: right;">572</td>
</tr>
<tr class="even">
<td style="text-align: right;">100億回（パラメータあり）</td>
<td style="text-align: right;">9,900</td>
<td style="text-align: right;">9,864</td>
</tr>
</tbody>
</table></li>
</ul>
<h2 id="文字列連結"><span class="header-section-number">6.3</span> 文字列連結</h2>
<h3 id="文字列連結繰り返し"><span class="header-section-number">6.3.1</span> 文字列連結（繰り返し）</h3>
<p>文字列連結を繰り返し処理中で行う際、<code>+</code>演算子で処理することはアンチパターンとして知られています。<br />
繰り返し処理中の文字列連結は、 <code>StringBuilder</code>、 <code>StringJoiner</code>、 <code>StringBuffer</code> を利用します。<br />
また、コレクション要素の結合であれば<code>String#join</code>が利用できます。</p>
<p>以下に処理例と計測結果を記載します。</p>
<ul>
<li><p><code>+</code>演算子</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;&quot;</span>;
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; list.<span class="fu">size</span>(); i++) {
    String string = list.<span class="fu">get</span>(i);
    <span class="kw">if</span> (i &gt; <span class="dv">0</span>) {
        s += <span class="st">&quot;,&quot;</span>;
    }
    s += string;
}
<span class="kw">return</span> s;</code></pre></div></li>
<li><p>StringBuilder</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">StringBuilder sb = <span class="kw">new</span> StringBuilder();
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; list.<span class="fu">size</span>(); i++) {
    String string = list.<span class="fu">get</span>(i);
    <span class="kw">if</span> (i &gt; <span class="dv">0</span>) {
        sb.<span class="fu">append</span>(<span class="st">&quot;,&quot;</span>);
    }
    sb.<span class="fu">append</span>(string);
}
<span class="kw">return</span> sb.<span class="fu">toString</span>();</code></pre></div></li>
<li><p>StringBuffer</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">StringBuffer sb = <span class="kw">new</span> StringBuffer();
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; list.<span class="fu">size</span>(); i++) {
    String string = list.<span class="fu">get</span>(i);
    <span class="kw">if</span> (i &gt; <span class="dv">0</span>) {
        sb.<span class="fu">append</span>(<span class="st">&quot;,&quot;</span>);
    }
    sb.<span class="fu">append</span>(string);
}
<span class="kw">return</span> sb.<span class="fu">toString</span>();</code></pre></div></li>
<li><p>String#join</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">return</span> String.<span class="fu">join</span>(<span class="st">&quot;,&quot;</span>, list);</code></pre></div></li>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理するListの件数</th>
<th style="text-align: right;"><code>+</code>演算子 (ms)</th>
<th style="text-align: right;">StringBuilder (ms)</th>
<th style="text-align: right;">StringBuffer (ms)</th>
<th style="text-align: right;">String#join (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1,000件</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1万件</td>
<td style="text-align: right;">1,016</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">1</td>
</tr>
<tr class="odd">
<td style="text-align: right;">10万件</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">5</td>
</tr>
<tr class="even">
<td style="text-align: right;">100万件</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">29</td>
<td style="text-align: right;">42</td>
<td style="text-align: right;">51</td>
</tr>
</tbody>
</table></li>
</ul>
<h3 id="文字列連結定数"><span class="header-section-number">6.3.2</span> 文字列連結（定数）</h3>
<p>基本的に処理中の文字列連結では<code>+</code>演算子は使わないで処理するほうがパフォーマンスが高くなりますが、定数の場合は<code>+</code>演算子で定義するほうがパフォーマンスが高いです。</p>
<p>たとえば以下のように、処理したい場合、</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String CONST_A = <span class="st">&quot;A&quot;</span>;
<span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String CONST_B = <span class="st">&quot;B&quot;</span>;
<span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String CONST_AB = CONST_A + CONST_B;</code></pre></div>
<p>StringBuilderで処理しようとすると以下のようになります。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> String CONST_AB = <span class="kw">new</span> StringBuilder(CONST_A).<span class="fu">append</span>(CONST_B).<span class="fu">toString</span>();</code></pre></div>
<p>しかし、これらをバイトコード上で確認するとそれぞれ以下のようになります。</p>
<ul>
<li><p><code>+</code>演算子</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> java.<span class="fu">lang</span>.<span class="fu">String</span> CONST_AB = <span class="st">&quot;AB&quot;</span>;</code></pre></div></li>
<li><p>StringBuilder</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">private</span> <span class="dt">static</span> <span class="dt">final</span> java.<span class="fu">lang</span>.<span class="fu">String</span> CONST_AB;

<span class="dt">static</span> {};
   <span class="dv">0</span>  <span class="kw">new</span> java.<span class="fu">lang</span>.<span class="fu">StringBuilder</span> [<span class="dv">20</span>]
   <span class="dv">3</span>  dup
   <span class="dv">4</span>  ldc &lt;String <span class="st">&quot;A&quot;</span>&gt; [<span class="dv">8</span>]
   <span class="dv">6</span>  invokespecial java.<span class="fu">lang</span>.<span class="fu">StringBuilder</span>(java.<span class="fu">lang</span>.<span class="fu">String</span>) [<span class="dv">22</span>]
   <span class="dv">9</span>  ldc &lt;String <span class="st">&quot;B&quot;</span>&gt; [<span class="dv">11</span>]
  <span class="dv">11</span>  invokevirtual java.<span class="fu">lang</span>.<span class="fu">StringBuilder</span>.<span class="fu">append</span>(java.<span class="fu">lang</span>.<span class="fu">String</span>) : java.<span class="fu">lang</span>.<span class="fu">StringBuilder</span> [<span class="dv">26</span>]
  <span class="dv">14</span>  invokevirtual java.<span class="fu">lang</span>.<span class="fu">StringBuilder</span>.<span class="fu">toString</span>() : java.<span class="fu">lang</span>.<span class="fu">String</span> [<span class="dv">30</span>]
  <span class="dv">17</span>  putstatic jp.<span class="fu">co</span>.<span class="fu">packagename</span>.<span class="fu">ClassName</span>.<span class="fu">CONST_AB</span> : java.<span class="fu">lang</span>.<span class="fu">String</span> [<span class="dv">34</span>]
  <span class="dv">20</span>  <span class="kw">return</span></code></pre></div></li>
</ul>
<p><code>+</code>演算子を利用した場合コンパイル時に最適化され、文字列<code>&quot;A&quot;</code>と<code>&quot;B&quot;</code>をあらかじめ結合してclassが作成されます。<br />
<code>StringBuilder</code>を利用した場合は最適化はされず、記述した通りの処理が行われます。</p>
<p>計測した場合、下記のようになります。</p>
<ul>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理回数</th>
<th style="text-align: right;">StringBuilder (ms)</th>
<th style="text-align: right;"><code>+</code>演算子 (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">5,000万回</td>
<td style="text-align: right;">559</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="even">
<td style="text-align: right;">1億回</td>
<td style="text-align: right;">1,059</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
</tbody>
</table></li>
</ul>
<p>通常、定数処理を大量に処理することは考えられないので性能問題になることはありませんが、<code>+</code>演算子を利用したほうがパフォーマンスが高いこともあるということを理解してください。</p>
<h2 id="listの種類"><span class="header-section-number">6.4</span> Listの種類</h2>
<p><code>List</code>には<code>ArrayList</code>のような<code>RandomAccess</code>をimplementsした、ランダムアクセスをサポートしているクラスと、<br />
<code>LinkedList</code>のようなランダムアクセスをサポートしていない（シーケンシャルアクセス）クラスが存在します。<br />
<code>RandomAccess</code>ではない<code>List</code>は、<code>List#get</code>などインデックスを利用するような操作のパフォーマンスが低いので注意してください。</p>
<p>以下に処理例と計測結果を記載します。</p>
<ul>
<li><p>for文(List#get(int)によるループ)</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> size = list.<span class="fu">size</span>();
<span class="kw">for</span> (<span class="dt">int</span> i = <span class="dv">0</span>; i &lt; size; i++) {
    String s = list.<span class="fu">get</span>(i);
    <span class="co">//処理</span>
}</code></pre></div></li>
<li><p>拡張for文</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="kw">for</span> (String s : list) {
    <span class="co">//処理</span>
}</code></pre></div></li>
<li><p>forEach</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">list.<span class="fu">forEach</span>(<span class="kw">this</span>::処理);</code></pre></div></li>
<li><p>計測結果</p>
<table>
<colgroup>
<col style="width: 13%"></col>
<col style="width: 14%"></col>
<col style="width: 14%"></col>
<col style="width: 14%"></col>
<col style="width: 14%"></col>
<col style="width: 14%"></col>
<col style="width: 14%"></col>
</colgroup>
<thead>
<tr class="header">
<th>処理するListの件数</th>
<th style="text-align: right;"><code>ArrayList</code><br>for文(List#get(int)によるループ) (ms)</th>
<th style="text-align: right;"><code>LinkedList</code><br>for文(List#get(int)によるループ) (ms)</th>
<th style="text-align: right;"><code>ArrayList</code><br>拡張for文 (ms)</th>
<th style="text-align: right;"><code>LinkedList</code><br>拡張for文 (ms)</th>
<th style="text-align: right;"><code>ArrayList</code><br>forEach (ms)</th>
<th style="text-align: right;"><code>LinkedList</code><br>forEach (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1万件</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">73</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="even">
<td>10万件</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">7,576</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td>20万件</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">17,740</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">0(計測不能)</td>
</tr>
<tr class="even">
<td>50万件</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">2</td>
</tr>
<tr class="odd">
<td>100万件</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0(計測不能)</td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td>1,000万件</td>
<td style="text-align: right;">16</td>
<td style="text-align: right;">(30秒以上)</td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">45</td>
<td style="text-align: right;">6</td>
<td style="text-align: right;">44</td>
</tr>
</tbody>
</table></li>
</ul>
<p>ランダムアクセスをサポートしている<code>List</code>がシーケンシャルアクセス（iteratorを利用した処理など）で遅いということはないので、<br />
ループの処理は拡張for文等、Iteratorによるループで記述するのが無難です。<br />
<code>List#get</code>での処理をすべて禁止することはできませんが、高いパフォーマンスが求められる場合は<code>List</code>の種類にも注目してみてください。</p>
<h2 id="オートボクシング"><span class="header-section-number">6.5</span> オートボクシング</h2>
<p>Javaには<code>int</code>のようなプリミティブ型と、<code>Integer</code>のようなプリミティブ型の値をクラスとして扱うためのラッパークラスが存在し、<br />
これらを意識せずコードを記述できるオートボクシングという機能があります。</p>
<p>しかし、オートボクシングを利用しているためにコーディング時に気づかない不要な処理を行っている可能性があるため、性能問題を避けるためには理解が必要です。</p>
<h3 id="オートボクシング例"><span class="header-section-number">6.5.1</span> オートボクシング例</h3>
<p>下記の2つの処理は等価ではありません。</p>
<ul>
<li><p>オートボクシングあり</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> value1 = <span class="dv">1</span>;
Integer value2 = value1;
<span class="dt">int</span> value3 = value2;</code></pre></div></li>
<li><p>キャストなし</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> value1 = <span class="dv">1</span>;
<span class="dt">int</span> value2 = value1;
<span class="dt">int</span> value3 = value2;</code></pre></div></li>
</ul>
<p>「オートボクシングあり」の処理を等価なオートボクシングの無い処理に置き換えると以下の処理になります。</p>
<ul>
<li><p>オートボクシングなし</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> value1 = <span class="dv">1</span>;
Integer value2 = Integer.<span class="fu">valueOf</span>(value1);
<span class="dt">int</span> value3 = value2.<span class="fu">intValue</span>();</code></pre></div></li>
</ul>
<p>「オートボクシングあり」のコードをコンパイルするとバイトコード上は「オートボクシングなし」の処理を行うこととなり、<br />
もし「キャストなし」の処理を意図していたなら、<code>Integer#valueOf</code>と<code>Integer#intValue</code>の処理が不要な処理です。</p>
<h3 id="オートボクシング性能"><span class="header-section-number">6.5.2</span> オートボクシング性能</h3>
<p>性能差が少ないため、ほとんど問題にはなりませんが、FindBugs等、静的解析で検出される問題のため、理解が必要です。</p>
<p>以下に計測結果を記載します。</p>
<ul>
<li><p>オートボクシング</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> value1 = <span class="dv">1</span>;
Integer value2 = value1;
<span class="dt">int</span> value3 = value2;</code></pre></div></li>
<li><p>オートボクシングなし</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java"><span class="dt">int</span> value1 = <span class="dv">1</span>;
<span class="dt">int</span> value2 = value1;
<span class="dt">int</span> value3 = value2;</code></pre></div></li>
<li><p>計測結果</p>
<p>（単位：マイクロ秒）</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理回数</th>
<th style="text-align: right;">オートボクシング (マイクロ秒)</th>
<th style="text-align: right;">オートボクシングなし (マイクロ秒)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">2,000兆回</td>
<td style="text-align: right;">10<br>max:297<br>min:0</td>
<td style="text-align: right;">4<br>max:154<br>min:0</td>
</tr>
</tbody>
</table></li>
</ul>
<h2 id="stringからintegerlongへの変換"><span class="header-section-number">6.6</span> StringからInteger・Longへの変換</h2>
<p>数値文字列の<code>String</code>を<code>Integer</code>に変換するには、<code>Integer#valueOf(String)</code>を利用して下記のように記述します。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;1&quot;</span>;
Integer value = Integer.<span class="fu">valueOf</span>(s);</code></pre></div>
<p>しかし、下記のようにも記述できます。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;1&quot;</span>;
Integer value = <span class="kw">new</span> Integer(s);</code></pre></div>
<p>これらの違いは、<br />
<code>new Integer(s)</code>とした場合、必ずIntegerインスタンスが生成されますが、<br />
<code>Integer.valueOf(s)</code>とした場合は -128から127の間の数値であればキャッシュから取り出すためインスタンスを生成しません。</p>
<p>このため、前者の<code>Integer#valueOf(String)</code>を利用した記述のほうが効率的です。<br />
<code>Long#valueOf(String)</code>も同様です。</p>
<p>性能差が少ないため、ほとんど問題にはなりませんが、FindBugs等、静的解析で検出される問題のため、理解が必要です。</p>
<p>また、Stringからの変換だけでなく、intやlongからの変換も<code>#valueOf</code>が効率的ですが、オートボクシングを利用した場合、コンパイルで自動的にこれらの処理に変換されるため、記述することはありません。</p>
<h2 id="stringからintlongへの変換"><span class="header-section-number">6.7</span> Stringからint・longへの変換</h2>
<p>数値文字列の<code>String</code>を<code>int</code>に変換するには、<code>Integer#parseInt(String)</code>を利用して下記のように記述します。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;1&quot;</span>;
<span class="dt">int</span> value = Integer.<span class="fu">parseInt</span>(s);</code></pre></div>
<p>しかし、オートボクシングが利用できるため、意図せず下記のように記述ミスをする場合があります。</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;1&quot;</span>;
<span class="dt">int</span> value = Integer.<span class="fu">valueOf</span>(s);<span class="co">//取得したIntegerインスタンスをオートボクシングでintにcastしている</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">String s = <span class="st">&quot;1&quot;</span>;
<span class="dt">int</span> value = <span class="kw">new</span> Integer(s);<span class="co">//生成したIntegerインスタンスをオートボクシングでintにcastしている</span></code></pre></div>
<p>「オートボクシング」の説明に記載した通り、性能に差が出るだけでなく、<br />
記述から明らかにミスであることが解るため、FindBugs等、静的解析で検出されるコードです。</p>
<p><code>long</code>への変換の場合は<code>Long#parseLong(String)</code>を利用します</p>
<p>以下に計測結果を記載します。</p>
<ul>
<li><p>計測結果</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理回数</th>
<th style="text-align: right;">Integer.valueOf(String) (ms)</th>
<th style="text-align: right;">Integer#parseInt(String) (ms)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1,000万回</td>
<td style="text-align: right;">396</td>
<td style="text-align: right;">318</td>
</tr>
<tr class="even">
<td style="text-align: right;">1億回</td>
<td style="text-align: right;">4,060</td>
<td style="text-align: right;">3,077</td>
</tr>
</tbody>
</table></li>
</ul>
<h2 id="bigdecimalのzeroとの比較"><span class="header-section-number">6.8</span> BigDecimalのZEROとの比較</h2>
<p>BigDecimalの正・負・ZEROの判定は<code>BigDecimal#signum</code>を利用します。<br />
<code>compareTo</code>を利用して<code>BigDecimal.ZERO</code>と比較しても同じことができますが、<code>signum</code>を利用したほうが効率的です。</p>
<p>以下に処理例と計測結果を記載します。</p>
<ul>
<li><p>compareTo利用</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal value = <span class="kw">new</span> BigDecimal(<span class="st">&quot;0.0&quot;</span>);
<span class="kw">if</span> (value.<span class="fu">compareTo</span>(BigDecimal.<span class="fu">ZERO</span>) == <span class="dv">0</span>) {</code></pre></div></li>
<li><p>signum利用</p>
<div class="sourceCode"><pre class="sourceCode java"><code class="sourceCode java">BigDecimal value = <span class="kw">new</span> BigDecimal(<span class="st">&quot;0.0&quot;</span>);
<span class="kw">if</span> (value.<span class="fu">signum</span>() == <span class="dv">0</span>) {</code></pre></div></li>
<li><p>計測結果</p>
<p>（単位：マイクロ秒）</p>
<table>
<thead>
<tr class="header">
<th style="text-align: right;">処理回数</th>
<th style="text-align: right;">compareTo利用 (マイクロ秒)</th>
<th style="text-align: right;">signum利用 (マイクロ秒)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: right;">1京回</td>
<td style="text-align: right;">527<br>max:26,367<br>min:0</td>
<td style="text-align: right;">424<br>max:21,213<br>min:0</td>
</tr>
</tbody>
</table></li>
</ul>
<p>性能差が少ないので、必ずしもsignumを利用する必要はありませんが、大量に処理する場合など、高いパフォーマンスが求められる場合は意識してください。</p>


<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://connect.facebook.net/ja_JP/sdk.js#xfbml=1&version=v2.7";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "https://buttons.github.io/buttons.js";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'git-buttons'));</script>
</body>
</html>
